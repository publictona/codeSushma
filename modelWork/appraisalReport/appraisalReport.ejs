<% include ../partials/head %>
    <% include ../partials/header %>

        <style>
            .searchBoxCashierPool .form-control,
            .searchBoxCashierPool .select2-selection {
                height: 35px !important;
                border: 1px solid lightgrey;
                border-radius: 14px !important;
                background-color: white;
            }

            .searchBoxCashierPool .select2-container--default .select2-selection--single {
                background: none;
            }

            .searchBoxCashierPool .select2 {
                background: none;
            }

            .alert {
                width: auto;
                padding: 20px;
                font-size: 15px;
                top: 63px !important;
                right: 20px !important;
                z-index: 999999 !important;
            }

            .pd-3 {
                padding-left: 10px;
            }

            .ui-autocomplete {
                z-index: 2147483647;
            }

            .contentRow {
                white-space: break-spaces !important;
            }

            .tourcode,
            .formno {
                text-transform: uppercase;
                font-size: 16px;
                font-weight: 800;
            }

            .tourname {
                font-size: 12px;
            }

            .tour-detials {
                font-size: 15px;
                white-space: nowrap;
            }

            .background-box {
                background: #dadada;
                padding: 1px 5px;
                border-radius: 4px;
            }

            .col-150 {
                min-width: 150px;
                max-width: 150px;
                width: 150px;
            }

            .col-50 {
                min-width: 50px;
                max-width: 50px;
                width: 50px;
            }

            .alert {
                width: auto;
                padding: 20px;
                font-size: 15px;
                top: 63px !important;
                right: 20px !important;
                z-index: 999999 !important;
            }

            .ibTable tr td {
                padding: 3px;
            }

            .calIpBox {
                border-bottom: 1px solid #fff;
            }

            label.error {
                display: block !important;
            }

            table tr td {
                white-space: unset;
                word-break: break-all;
            }
        </style>

        <div class="box">
            <div class="box-header with-border with-hamburger">
                <a href="javascript:void(0);" class="box-header-hamburger-menu" onclick="openNav()">
                    <i class="fa fa-bars" aria-hidden="true"></i>
                </a>
                <h3 class="box-title">Appraisal Report</h3>
            </div>
            <div class="box-body">
                <div class="row gutter--3px">

                    <div class="box box-primary">
                        <div class="box-body">
                            <div class="col-md-12">
                                <div class="row gutter--3px">

                                    <div class="col-md-12 mt-10">
                                        <form id="Filter" class="searchBoxCashierPool clearfix">
                                            <div class="row gutter--3px">

                                                <div class="form-group col-md-2">

                                                    <select class="form-control F21_DESIG" name="F21_DESIG">
                                                        <option value="">Designation</option>

                                                    </select>
                                                </div>

                                                <div class="form-group col-md-2">

                                                    <select class="form-control F21_DEPT" name="F21_DEPT">
                                                        <option value="">Department</option>

                                                    </select>
                                                </div>

                                                <div class="form-group col-md-2">

                                                    <select class="form-control F21_BRANCH" name="F21_BRANCH">
                                                        <option value="">Branch</option>

                                                    </select>
                                                </div>


                                                <div class="col-md-2">
                                                    <button type="submit"
                                                        class="btn btn-primary btn-lg btn-block">Filter</button>
                                                </div>

                                            </div>
                                        </form>

                                    </div>
                                    <div class="col-md-12">
                                        <table id="uspList"
                                            class="table table-bordered table-responsive table-striped display nowrap order-column"
                                            style="width:100%">

                                        </table>

                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!---------------------- add Tour Journey breakup ------------------------------------>
        <div class="modal fade" id="appraisalModel" role="dialog">
            <div class="modal-dialog modal-lg">
                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title bdgDetailsDtl" id="bdgHdrTouCode">KRAS And Self Appraisals Details</h4>
                    </div>
                    <!-- <div class="modal-body"> -->




                    <div class="modal-body col-md-6">
                        <h5><strong>KRA Table</strong></h5>
                        <table id="kraTable" class="table table-bordered table-striped" style="width:100%;">
                            <thead>
                                <tr>
                                    <th style="font-family: monospace;font-size: 12px;" colspan="3">Functions</th>
                                </tr>

                                <tr>

                                    <th style="font-family: monospace;font-size: 12px;">KRA</th>
                                    <th style="font-family: monospace;font-size: 12px;">measures</th>
                                    <th style="font-family: monospace;font-size: 12px;"> weightage</th>

                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>

                    </div>


                    <div class="modal-body col-md-6">
                        <h5><strong>Self Appraisal Table</strong></h5>
                        <table id="AppraisalTable" class="table table-bordered table-striped" style="width:100%;">
                            <thead>
                                <tr>
                                    <th>Field</th>
                                    <th>Value</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>

                    </div>

                    <div class="modal-body col-md-6">
                        <h5><strong>Question Table</strong></h5>
                        <table id="questionDetailsTable" class="table table-bordered table-striped" style="width:100%;">
                            <thead>
                                <tr>
                                    <th style="font-family: monospace;font-size: 12px;" colspan="3">Question Details
                                    </th>
                                </tr>

                                <tr>
                                    <th style="font-family: monospace;font-size: 12px;">Question</th>
                                    <th style="font-family: monospace;font-size: 12px;">Answer</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>

                    </div>

                    <div class="modal-body col-md-6">
                        <h5><strong>Skill Details Table</strong></h5>
                        <table id="skillDetailsTable" class="table table-bordered table-striped" style="width:100%;">
                            <thead>
                                <tr>
                                    <th style="font-family: monospace;font-size: 12px;" colspan="3">Skill Details</th>
                                </tr>

                                <tr>
                                    <th style="font-family: monospace;font-size: 12px;">name</th>
                                    <th style="font-family: monospace;font-size: 12px;">selfRating</th>
                                    <th style="font-family: monospace;font-size: 12px;">managerRating</th>
                                </tr>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>

                    </div>



                    <div class="modal-body col-md-6">
                        <h5><strong>Overall Ratings Table </strong></h5>
                        <table id="overallRatingsTable" class="table table-bordered table-striped" style="width:100%;">
                            <thead>
                                <tr>
                                    <th>Field</th>
                                    <th>Value</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>

                    </div>



                    <!-- </div> -->
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>

            </div>
        </div>

        <script>

            var DrawTableInquiry;
            $(document).ready(function () {
                getF21_DESIG();
                getF21_DEPT();
                getF21_BRANCH();


                var dataColumns = [

                    {
                        data: "_id",
                        sTitle: "Id",
                        visible: false
                    },

                    {
                        data: "F21_NAME",
                        sTitle: "Name#",
                        visible: true,
                        className: "fs14--design column-12",

                    },

                    {
                        data: "F21_DESIG",
                        sTitle: "Degignation#",
                        visible: true,
                        className: "fs14--design column-12",

                    },

                    {
                        data: "F21_DEPT",
                        sTitle: "Depart#",
                        visible: true,
                        className: "fs14--design column-12",

                    },

                    {
                        data: "F21_BRANCH",
                        sTitle: "Branch#",
                        visible: true,
                        className: "fs14--design column-12",

                    },

                    // {
                    //     data: "KRA_IDNO",
                    //     sTitle: "KRA_IDNO#",
                    //     visible: true,
                    //     className: "fs14--design column-12",

                    // },

                    {
                        data: "F21_SRNO",
                        sTitle: "F21_SRNO#",
                        visible: true,
                        className: "fs14--design column-12",

                    },



                    {
                        data: "v",
                        sTitle: "A",
                        visible: true,
                        className: "fs15--design column-50",
                        render: function (data, type, row) {
                            var html = '';
                            html = '<span class="btn btn-primary btn-block" data-id="' + row.F21_SRNO + '" onclick="getTourDetail(this) " >view</span>';

                            return html;
                        }
                    },
                ];

                DrawTableInquiry = DrawCustomDataTable("uspList", 350,
                    "/route/appraisalReport/grid-data", dataColumns, [
                    [0, "asc"]
                ], "Filter", null, true, true);

                $("#Filter").validate({
                    errorPlacement: function (error, element) { },
                    submitHandler: function (form) {
                        DrawTableInquiry.ajax.reload();
                    }
                });
                $('.textUpper').on('keyup', function (e) {
                    $(this).val($(this).val().toUpperCase());
                });

                $("form#regForm").submit(function (e) {
                    //$('#newUserBox').modal('hide');
                    e.preventDefault();
                });

                $("#regForm").validate({
                    rules: {
                        suppliercat: "required",
                    },
                    messages: {
                        suppliercat: "Supplier Category is required",
                    },

                    errorPlacement: function (error, element) {
                        offset = element.offset();
                        error.insertAfter(element)
                        error.addClass('message');
                        error.css('display', 'block!important');
                        error.css('color', 'red');
                    },

                    submitHandler: function (form) {

                        $('#newUserBox').modal('hide');
                        var $form = $(form);
                        var formData = $form.serializeObject();

                        var method = "post";
                        var url = "/route/assetMaster/create";
                        console.log(formData.id);
                        if (formData.id != 0) {
                            url =
                                '/route/assetMaster/update/' +
                                formData.id;
                            method = "put";
                        }
                        $.ajax({
                            url: url,
                            type: method,
                            contentType: "application/json; charset=utf-8",
                            data: JSON.stringify(formData),
                            dataType: "json",

                            success: function (result) {
                                if (result.status) {
                                    notification({
                                        type: "success",
                                        message: result
                                            .msg
                                    });

                                    DrawTableInquiry.ajax
                                        .reload();
                                    $("#regForm")[0].reset();
                                }
                            }
                        });
                    }
                });
            });

            for (var j = 0; j < res[i].Asset_Trans.length; j++) {
                html += `<tr>

                         <td style="font-family: monospace;font-size: 12px; padding-left: 8px; border-bottom: 1px solid #ddd;">${res[i].Asset_Trans[j].modelNo}</td>

                         </tr>`;
            }


            function createJbrkDTlTab(id) {
                //  console.log("JBRKID", id);
                $.ajax({
                    url: "/route/appraisalReport/data/" + id,
                    type: "get",
                    data: {
                        id: id
                    },
                    success: function (result) {
                        var str = ``;
                        if (result.krasData) {
                            console.log("result", result.krasData)
                            for (var i = 0; i < result.krasData.length; i++) {
                                var functionalArray = result.krasData[i].functional;
                                if (functionalArray && functionalArray.length > 0) {
                                    for (var j = 0; j < functionalArray.length; j++) {
                                        var functionalObject = functionalArray[j];
                                        str += ` <tr>
                                     <td>${functionalObject.kra}</td> 
                                     <td>${functionalObject.measures}</td> 
                                     <td>${functionalObject.weightage}</td> 
                                    </tr>`;
                                        $('#kraTable tbody').html(str);
                                    }
                                }



                            }
                        }

                        var str1 = ``;
                        if (result.selfAppraisalData) {
                            for (var i = 0; i < result.selfAppraisalData.length; i++) {
                                var questionDetails = result.selfAppraisalData[i].questionDetails;
                                str1 += `<tr>
                                    <tr><td>Name</td> <td>${result?.selfAppraisalData[i].name}</td></tr>
                                    <tr><td>Date Of Joining</td> <td>${result?.selfAppraisalData[i].dateOfJoining}</td></tr>
                                    <tr><td>Gross Payment</td> <td>${result?.selfAppraisalData[i].grossPayment}</td></tr>
                                    <tr><td>Qualification</td> <td>${result?.selfAppraisalData[i].qualification}</td></tr>
                                    <tr><td>Last Increment</td> <td>${result?.selfAppraisalData[i].lastIncrement}</td></tr>
                                    <tr><td>Time To Office</td> <td>${result?.selfAppraisalData[i].timeToOffice}</td></tr>
                                    <tr><td>Confirmation Hike</td> <td>${result?.selfAppraisalData[i].confirmationHike}</td></tr>
                                    <tr><td>Immediate Manager Name</td> <td>${result?.selfAppraisalData[i].immediateManagerName}</td></tr>
                                    <tr><td>Designation</td> <td>${result?.selfAppraisalData[i].designation}</td></tr>
                                    <tr><td>Department</td> <td>${result?.selfAppraisalData[i].department}</td></tr>
                                    <tr><td>School Medium</td> <td>${result?.selfAppraisalData[i].schoolMedium}</td></tr>
                                    <tr><td>Marriage Status</td> <td>${result?.selfAppraisalData[i].marriageStatus}</td></tr>
                                    <tr><td>Total Experiance</td> <td>${result?.selfAppraisalData[i].totalExperiance}</td></tr>
                                    <tr><td>Total Kesari Experiance</td> <td>${result?.selfAppraisalData[i].totalKesariExperiance}</td></tr>
                                    <tr><td>Total Domain Experiance</td> <td>${result?.selfAppraisalData[i].totalDomainExperiance}</td></tr>
                                    <tr><td>Manager Remark</td> <td>${result?.selfAppraisalData[i].managerRemark}</td></tr>
                                    <tr><td>Branch</td> <td>${result?.selfAppraisalData[i].branch}</td></tr>
                                    <tr><td>Year</td> <td>${result?.selfAppraisalData[i].year}</td></tr>

                                    


                                     </tr>`;
                                $('#AppraisalTable tbody').html(str1);
                            }
                        }

                        var str2 = ``;
                        if (result.selfAppraisalData) {
                            //console.log("result", result.selfAppraisalData)
                            for (var i = 0; i < result.selfAppraisalData.length; i++) {
                                var questionDetailsArray = result.selfAppraisalData[i].questionDetails;
                                if (questionDetailsArray && questionDetailsArray.length > 0) {
                                    for (var j = 0; j < questionDetailsArray.length; j++) {
                                        var questionDetailsObject = questionDetailsArray[j];
                                        str2 += ` <tr>
                                       <td>${questionDetailsObject.question}</td> 
                                        <td>${questionDetailsObject.answer}</td> 
                                      
                                           </tr>`;
                                        $('#questionDetailsTable tbody').html(str2);
                                    }
                                }
                            }
                        }

                        var str3 = ``;
                        if (result.selfAppraisalData) {
                            //console.log("result", result.selfAppraisalData)
                            for (var i = 0; i < result.selfAppraisalData.length; i++) {
                                var skillDetailsArray = result.selfAppraisalData[i].skillDetails;
                                if (skillDetailsArray && skillDetailsArray.length > 0) {
                                    for (var j = 0; j < skillDetailsArray.length; j++) {
                                        var skillDetailsObject = skillDetailsArray[j];
                                        str3 += ` <tr>
                                       <td>${skillDetailsObject.name}</td> 
                                        <td>${skillDetailsObject.selfRating}</td> 
                                        <td>${skillDetailsObject.managerRating}</td> 
                                        
                                           </tr>`;
                                        $('#skillDetailsTable tbody').html(str3);
                                    }
                                }
                            }
                        }

                        var str4 = ``;
                        if (result.selfAppraisalData) {
                            for (var i = 0; i < result.selfAppraisalData.length; i++) {
                                var overallRatings = result.selfAppraisalData[i].overallRatings;
                                str4 += `<tr>
                                    <tr><td>Total Manager Rating</td> <td>${overallRatings.totalManagerRating}</td></tr>
                                    <tr><td>Total Manager Weightage</td> <td>${overallRatings.totalManagerWeightage}</td></tr>
                                    <tr><td>Total Self Weightage</td> <td>${overallRatings.totalSelfWeightage}</td></tr>
                                    <tr><td>Total Self Rating</td> <td>${overallRatings.totalSelfRating}</td></tr>
                                    <tr><td>Tota Weightage</td> <td>${overallRatings.totalWeightage}</td></tr>
                                    <tr><td>Total Rating</td> <td>${overallRatings.totalRating}</td></tr>
                                    
                                     </tr>`;
                                $('#overallRatingsTable tbody').html(str4);
                            }
                        }

                    }

                })

            }

            function getTourDetail(e) {
                var id = e.getAttribute('data-id');
                $('#F21_SRNO').val(id);
                createJbrkDTlTab(id);
                $('#appraisalModel').modal('show');
            }

            function addNewUser() {
                $('#newUserBox').modal('show');
            }

            function populate(frm, data) {
                $.each(data, function (key, value) {
                    $('[name=' + key + ']', frm).val(value);
                });
                $('.sector').select2();
            }

            function getUser(id) {
                var id = id.getAttribute('data-id');
                $.ajax({
                    url: "/route/assetMaster/getData",
                    type: "get",
                    data: {
                        id: id
                    },
                    success: function (result) {

                        var tranNO = '&nbsp;&nbsp;&nbsp;&nbsp;Tran No :- ' + result.data.tranNo;
                        $("#topTranNo").html(tranNO);

                        var iddata = {
                            id: result.data._id
                        }
                        $.when($('#regForm').populate(result.data)).done(function (x) {

                            $('.itemCode').attr('disabled', true);
                        });
                        $("#suppliercat").select2();
                        $("#Place").select2();
                        $(".supplier").html();


                        // ------
                        populate('#regForm', result.data);
                        populate('#regForm', iddata);

                        $('#newUserBox').modal('show');

                    }
                })
            }

            function getF21_DESIG() {
                var tray_url = "/route/appraisalReport/getF21_DESIG";
                $.getJSON(tray_url, function (data) {
                    var optionList1 = '<option value="">Designation</option>';
                    for (var i = 0; i < data.length; i++) {
                        //  console.log("optionList1",data)
                        optionList1 += '<option value="' + data[i] + '">' +
                            data[i] + '</option>'
                    }

                    $('.F21_DESIG').html(optionList1);
                    $('.F21_DESIG').select2();
                });
            }

            function getF21_DEPT() {
                var tray_url = "/route/appraisalReport/getF21_DEPT";
                $.getJSON(tray_url, function (data) {
                    var optionList2 = '<option value="">Department</option>';
                    for (var i = 0; i < data.length; i++) {
                        //  console.log("optionList1",data)
                        optionList2 += '<option value="' + data[i] + '">' +
                            data[i] + '</option>'
                    }

                    $('.F21_DEPT').html(optionList2);
                    $('.F21_DEPT').select2();
                });
            }

            function getF21_BRANCH() {
                var tray_url = "/route/appraisalReport/getF21_BRANCH";
                $.getJSON(tray_url, function (data) {
                    var optionList3 = '<option value="">Branch</option>';
                    for (var i = 0; i < data.length; i++) {
                        //  console.log("optionList1",data)
                        optionList3 += '<option value="' + data[i] + '">' +
                            data[i] + '</option>'
                    }

                    $('.F21_BRANCH').html(optionList3);
                    $('.F21_BRANCH').select2();
                });
            }

        </script>

        <% include ../partials/footer %>