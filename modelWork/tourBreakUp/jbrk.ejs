<% include ../partials/head %>
    <% include ../partials/header %>

        <style>
            .pd-3 {
                padding-left: 10px;
            }

            .ui-autocomplete {
                z-index: 2147483647;
            }

            .contentRow {
                white-space: break-spaces !important;
            }

            .tourcode,
            .formno {
                text-transform: uppercase;
                font-size: 16px;
                font-weight: 800;
            }

            .tourname {
                font-size: 12px;
            }

            .tour-detials {
                font-size: 15px;
                white-space: nowrap;
            }

            .background-box {
                background: #dadada;
                padding: 1px 5px;
                border-radius: 4px;
            }

            .col-150 {
                min-width: 150px;
                max-width: 150px;
                width: 150px;
            }

            .col-50 {
                min-width: 50px;
                max-width: 50px;
                width: 50px;
            }

            .alert {
                width: auto;
                padding: 20px;
                font-size: 15px;
                top: 63px !important;
                right: 20px !important;
                z-index: 999999 !important;
            }

            .ibTable tr td {
                padding: 3px;
            }

            .calIpBox {
                border-bottom: 1px solid #fff;
            }

            label.error {
                display: block !important;
            }

            /* table */
            .ui-autocomplete {
                z-index: 9999
            }

            #tbl-bdgDetails {
                padding-top: 5px;
            }

            #tbl-bdgDetails td:nth-child(1),
            #tbl-bdgDetails th:nth-child(1) {
                width: 10px !important;
            }

            #tbl-bdgDetails td:nth-child(2),
            #tbl-bdgDetails th:nth-child(2) {
                width: 225px !important;
            }

            #tbl-bdgDetails td:nth-child(3),
            #tbl-bdgDetails th:nth-child(3) {
                width: 50px !important;
            }

            #tbl-bdgDetails td:nth-child(4),
            #tbl-bdgDetails th:nth-child(4) {
                width: 50px !important;
            }

            #tbl-bdgDetails td:nth-child(5),
            #tbl-bdgDetails th:nth-child(5) {
                width: 30px !important;
            }

            #tbl-bdgDetails td:nth-child(6),
            #tbl-bdgDetails th:nth-child(6) {
                width: 30px !important;
                text-align: right !important;
            }

            #tbl-bdgDetails td:nth-child(7),
            #tbl-bdgDetails th:nth-child(7) {
                width: 30px !important;
                text-align: right !important;
            }

            #tbl-bdgDetails td:nth-child(8),
            #tbl-bdgDetails th:nth-child(8) {
                width: 30px !important;
                text-align: right !important;
            }

            #tbl-bdgDetails td:nth-child(9),
            #tbl-bdgDetails th:nth-child(9) {
                width: 30px !important;
                text-align: right !important;
            }

            #lockButton {
                width: 147px;
                border: 1px solid;
            }

            #lockButton:hover {
                background-color: darkgray;
            }

            #addExpenseButton {
                margin-left: -13px;
            }

            #newExpenseDetail_form_submitBtn {
                width: 100%;
                margin-top: 25px;
                margin-bottom: 15px;
            }

            .formInputNumber {
                width: 100% !important;
                text-align: right;
            }

            #F_AMOUNT {
                text-align: right;
            }

            input[type=number] {
                text-align: right;
            }


            /* ----------------- */
        </style>

        <div class="box">
            <div class="box-header with-border with-hamburger">
                <a href="javascript:void(0);" class="box-header-hamburger-menu" onclick="openNav()">
                    <i class="fa fa-bars" aria-hidden="true"></i>
                </a>
                <h3 class="box-title">JBRK Tour </h3>
            </div>
            <div class="box-body">
                <div class="row gutter--3px">
                    <div class="col-md-12">
                        <span class="btn btn-primary" onclick="addNewUser()"><i class="fa fa-plus"></i> Add JBRK Tour
                        </span>
                    </div>

                    <div class="col-md-12 r-col">
                        <table id="uspList" class="table table-bordered table-striped display nowrap order-column"
                            style="width:100%;">
                            <tbody class="appar">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="newUserBox" tabindex="-1" role="dialog" aria-labelledby="newUserBox"
            aria-hidden="true">
            <div class="modal-dialog modal-sm" role="document">

                <div class="modal-content">
                    <div class="modal-header">Add JBRK Tour Details <span id="topF_TRANNO" class="fs15--design"> </span>
                        </h5>

                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="regForm">
                            <div class="row gutter--3px">
                                <div class="col-md-12">
                                    <div class="row gutter--3px pd-3">

                                        <div class="form-group row col-sm-12">
                                            <input type="hidden" class="form-control jbrkId" name="id" value="0">
                                            <label for="" class="col-sm-3 col-form-label fs15--design"> Tour Sr. <span
                                                    style="color: rgb(158, 6, 6);">*</span></label>
                                            </label>
                                            <div class="col-sm-9">
                                                <input type="text" class="form-control F_TCD" name="F_TCD"
                                                    oninput="this.value = this.value.toUpperCase();" minlength="2"
                                                    maxlength="2" autocomplete="off" required />
                                            </div>
                                        </div>

                                        <div class="form-group row col-sm-12">
                                            <label for="" class="col-sm-3 col-form-label fs15--design">Sector
                                                <span style="color: rgb(158, 6, 6);">*</span></label>
                                            <div class="col-sm-9">
                                                <input type="text" class="form-control F_SECTOR" name="F_SECTOR"
                                                    autocomplete="off" required />
                                            </div>
                                        </div>



                                    </div>

                                </div>

                                <div class="col-md-12 mt-10">
                                    <button type="submit" class="btn btn-primary btn-block">SAVE</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>


        <!---------------------- add Tour Journey breakup ------------------------------------>
        <div class="modal fade" id="tourBreakUpModel" role="dialog">
            <div class="modal-dialog modal-md">
                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title bdgDetailsDtl" id="bdgHdrTouCode">Tour Break Up Details</h4>
                    </div>
                    <!-- <div class="modal-body"> -->


                    <div class="modal-body">

                        <div class="col-md-6">
                            <span class="btn btn-primary" id="Add_Designation_Details"> Add Tour Details
                            </span>
                        </div>
                        <br>
                        <br>
                        <table id="jbrkdtlTable" class="table table-bordered table-striped" style="width:100%;">
                            <thead>
                                <tr>
                                    <th>Tran</th>
                                    <th>Mst No</th>
                                    <th>From</th>
                                    <th>To</th>
                                    <th>Distance</th>
                                    <th>Edit</th>
                                    <th>Delete</th>
                                </tr>
                            </thead>
                            <tbody>

                            </tbody>
                        </table>

                    </div>
                    <!-- </div> -->
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>

            </div>
        </div>

        <div class="modal fade" id="tourDetailsBox" tabindex="-1" role="dialog" aria-labelledby="tourDetailsBox"
            aria-hidden="true">
            <div class="modal-dialog modal-sm" role="document">

                <div class="modal-content">
                    <div class="modal-header">Add JBRK Details <span id="topF_TRANNO" class="fs15--design"> </span>
                        </h5>

                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="TourDetailsForm">
                            <div class="row gutter--3px">
                                <div class="col-md-12">
                                    <div class="row gutter--3px pd-3">

                                        <div class="form-group row col-sm-12">
                                            <input type="hidden" class="form-control jbdtlId" name="id" value="0">
                                            <input type="hidden" class="form-control F_MSTNO" name="F_MSTNO"
                                                id="F_MSTNO1" value="0">

                                            <label for="" class="col-sm-3 col-form-label fs15--design"> From <span
                                                    style="color: rgb(158, 6, 6);">*</span></label>
                                            </label>
                                            <div class="col-sm-9">
                                                <input type="text" class="form-control F_FROM" name="F_FROM"
                                                    autocomplete="off" required />
                                            </div>
                                        </div>

                                        <div class="form-group row col-sm-12">

                                            <label for="" class="col-sm-3 col-form-label fs15--design"> To <span
                                                    style="color: rgb(158, 6, 6);">*</span></label>
                                            </label>
                                            <div class="col-sm-9">
                                                <input type="text" class="form-control F_TO" name="F_TO"
                                                    autocomplete="off" required />
                                            </div>
                                        </div>

                                        <div class="form-group row col-sm-12">
                                            <label for="" class="col-sm-3 col-form-label fs15--design">Distance </label>

                                            <div class="col-sm-9">
                                                <input type="number" class="form-control F_DIST" name="F_DIST"
                                                    autocomplete="off" required />
                                            </div>
                                        </div>
                                    </div>

                                </div>

                                <div class="col-md-12 mt-10">
                                    <button type="submit" class="btn btn-primary btn-block">SAVE</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- ======================================END ========================================== -->

        <script>

            var DrawTableInquiry;


            $(document).ready(function () {


                var dataColumns = [{
                    data: "_id",
                    sTitle: "Id",
                    visible: false
                },

                {
                    data: "F_TRANNO",
                    sTitle: "Tran#",
                    visible: true,
                    className: "fs14--design column-12",

                },

                {
                    data: "F_MSTNO",
                    sTitle: "F_MSTNO",
                    visible: true,
                    className: "fs15--design",
                },



                {
                    data: "F_TRANID",
                    sTitle: "F_TRANID",
                    visible: true,
                    className: "fs15--design",
                },

                {
                    data: "F_TRANDT",
                    sTitle: "F_TRANDT",
                    visible: true,
                    className: "fs15--design",
                    render: function (data, type, row) {
                        //console.log(row);
                        var html = ""
                        return dateFormat(row.F_TRANDT);
                    }
                },

                {
                    data: "F_SECTOR",
                    sTitle: "F_SECTOR",
                    visible: true,
                    className: "fs15--design",
                },

                {
                    data: "F_TCD",
                    sTitle: "F_TCD",
                    visible: true,
                    className: "fs15--design",
                },

                {
                    data: "F_DELID",
                    sTitle: "F_DELID",
                    visible: true,
                    className: "fs15--design",
                },

                {
                    data: "F_DELDT",
                    sTitle: "F_DELDT",
                    visible: true,
                    className: "fs15--design",
                    render: function (data, type, row) {
                        //console.log(row);
                        var html = ""
                        return dateFormat(row.F_DELDT);
                    }
                },

                {
                    data: "v",
                    sTitle: "A",
                    visible: true,
                    className: "fs15--design column-50",
                    render: function (data, type, row) {
                        var html = '';
                        html = '<span class="btn btn-primary btn-block" data-id="' + row.F_MSTNO + '" onclick="getTourDetail(this) " >view</span>';

                        return html;
                    }
                },

                {
                    data: "action",
                    sTitle: "Action",
                    visible: true,
                    className: "fs15--design column-30",
                    render: function (data, type, row) {
                        //console.log(row);
                        var html =
                            ' <span class="btn btn-success btn-block" data-id="' + row._id + '" onclick="getUser(this) "> Edit</span>';
                        return html;
                    }
                },

                {
                    data: "v",
                    sTitle: "A",
                    visible: true,
                    className: "fs15--design column-35",
                    render: function (data, type, row) {
                        var html = '';
                        html = ' <span class="btn btn-danger btn-block" data-id="' + row._id + '" onclick="deleteTour(this) ">Delete</span>';
                        return html;
                    }
                }

                ];

                DrawTableInquiry = DrawCustomDataTable("uspList", 350,
                    "/route/JBRKTourDetails/grid-data", dataColumns, [
                    [0, "asc"]
                ], "frm_grid_search", null, true, true);

                $("#frm_grid_search").validate({
                    errorPlacement: function (error, element) { },
                    submitHandler: function (form) {
                        DrawTableInquiry.ajax.reload();
                    }
                });
                $('.textUpper').on('keyup', function (e) {
                    $(this).val($(this).val().toUpperCase());
                });

                $("form#regForm").submit(function (e) {
                    //$('#newUserBox').modal('hide');
                    e.preventDefault();
                });

                $("#regForm").validate({
                    rules: {
                        //  suppliercat: "required",
                    },
                    messages: {
                        // suppliercat: "Supplier Category is required",
                    },

                    errorPlacement: function (error, element) {
                        offset = element.offset();
                        error.insertAfter(element)
                        error.addClass('message');
                        error.css('display', 'block!important');
                        error.css('color', 'red');
                    },

                    submitHandler: function (form) {

                        $('#newUserBox').modal('hide');
                        var $form = $(form);
                        var formData = $form.serializeObject();
                        console.log("formDataformData", formData)

                        var method = "post";
                        var url = "/route/JBRKTourDetails/create";
                        // console.log(formData.id);
                        if (formData.id != 0) {
                            url =
                                '/route/JBRKTourDetails/updateData/' +
                                formData.id;
                            method = "put";
                        }
                        $.ajax({
                            url: url,
                            type: method,
                            contentType: "application/json; charset=utf-8",
                            data: JSON.stringify(formData),
                            dataType: "json",

                            success: function (result) {
                                if (result.status) {
                                    notification({
                                        type: "success",
                                        message: result
                                            .msg
                                    });

                                    DrawTableInquiry.ajax.reload();

                                    $("#regForm")[0].reset();
                                }
                            }
                        });
                    }
                });
            });

            function addNewUser() {
                $('.jbrkId').val("0");
                $('.F_TCD').val("");
                $('.F_SECTOR').val("");
                $('#newUserBox').modal('show');
            }

            function populate(frm, data) {
                $.each(data, function (key, value) {
                    $('[name=' + key + ']', frm).val(value);
                });
                $('.sector').select2();
            }

            function getUser(id) {
                var id = id.getAttribute('data-id');
                $('.jbrkId').val(id);
                $.ajax({
                    url: "/route/JBRKTourDetails/getdata",
                    type: "get",
                    data: {
                        id: id
                    },
                    success: function (result) {

                        var F_TRANNO = '&nbsp;&nbsp;&nbsp;&nbsp;Tran No :- ' + result.data.F_TRANNO;
                        $("#topF_TRANNO").html(F_TRANNO);

                        var iddata = {
                            id: result.data._id
                        }
                        $.when($('#regForm').populate(result.data)).done(function (x) {

                        });
                        $('#newUserBox').modal('show');

                    }
                })
            }

            function openNav() {
                document.getElementById("mySidenav").style.width = "250px";
            }

            function closeNav() {
                document.getElementById("mySidenav").style.width = "0";
            }

            function createJbrkDTlTab(id) {
                console.log("JBRKID", id);
                $.ajax({
                    url: "/route/JBRKTourDetails/details/" + id,
                    type: "get",
                    data: {
                        id: id
                    },
                    success: function (result) {
                        var str = ``;
                        if (result.data) {
                            for (var i = 0; i < result.data.length; i++) {
                                str += `<tr>
                                    
                                        <td>${result.data[i].F_TRANNO}</td>
                                        <td>${result.data[i].F_MSTNO}</td>
                                        <td>${result.data[i].F_FROM}</td>
                                        <td>${result.data[i].F_TO}</td>
                                        <td>${result.data[i].F_DIST}</td> 
                                        
                                        <td> <span class="btn btn-sm btn-success" data-id="${result.data[i]._id}" data-mst="${result.data[i].F_MSTNO}" onclick="getUserTourDetails(this) ">Edit</span> </td>
                                        <td> <span class="btn btn-sm btn-danger" data-id="${result.data[i]._id}" data-mst="${result.data[i].F_MSTNO}" onclick="deleteTourDetails(this) ">delete</span> </td>
                                        </tr>`;
                                $('#jbrkdtlTable tbody').html(str);

                            }


                        }

                    }
                })

            }
            function getTourDetail(e) {
                var id = e.getAttribute('data-id');
                $('#F_MSTNO1').val(id);
                createJbrkDTlTab(id);
                $('#tourBreakUpModel').modal('show');


            }

            function deleteTour(id) {

                var id = id.getAttribute('data-id');

                if (window.confirm("Do You Really Want To Delete")) {
                    $.ajax({
                        url: "/route/JBRKTourDetails/deleteTour",
                        type: "POST",
                        data: {
                            id: id,
                        },

                        success: function (result) {
                            console.log("resultresultresultresult", result)
                            DrawTableInquiry.ajax.reload();
                            alert("Deleted SuccessFully");

                        }
                    })
                }
            }


        </script>

        <script>
            //------------------------ TOUR DETAILS JS-------------------------------
            var DrawTableInquiry1;
            $(document).ready(function () {

                DrawTableInquiry1 = DrawCustomDataTable("uspList1", 350,
                    "/route/JBRKTourDetails/grid-dataNewJourney", [
                    [0, "asc"]
                ], "frm_grid_search", null, true, true);

                $("#frm_grid_search").validate({
                    errorPlacement: function (error, element) { },
                    submitHandler: function (form) {
                        DrawTableInquiry1.ajax.reload();
                    }
                });
                $('.textUpper').on('keyup', function (e) {
                    $(this).val($(this).val().toUpperCase());
                });

                $("form#TourDetailsForm").submit(function (e) {

                    e.preventDefault();
                });

                $("#TourDetailsForm").validate({
                    rules: {

                    },
                    messages: {

                    },

                    errorPlacement: function (error, element) {
                        offset = element.offset();
                        error.insertAfter(element)
                        error.addClass('message');
                        error.css('display', 'block!important');
                        error.css('color', 'red');
                    },

                    submitHandler: function (form) {

                        $('#tourDetailsBox').modal('hide');

                        var $form = $(form);
                        var formData = $form.serializeObject();

                        formData.F_MSTNO = $('#F_MSTNO1').val();

                        var method = "post";
                        var url = "/route/JBRKTourDetails/createNewJourney";
                        if (formData.id != 0) {
                            url =
                                '/route/JBRKTourDetails/updateNewJourney/' +
                                formData.id;
                            method = "put";
                        }
                        $.ajax({
                            url: url,
                            type: method,
                            contentType: "application/json; charset=utf-8",
                            data: JSON.stringify(formData),
                            dataType: "json",

                            success: function (result) {
                                if (result.status) {
                                    notification({
                                        type: "success",
                                        message: result
                                            .msg
                                    });
                                    createJbrkDTlTab($('#F_MSTNO1').val());
                                    $("#TourDetailsForm")[0].reset();
                                }
                            }
                        });
                    }
                });
            });



            $(document).on("click", "#Add_Designation_Details", function () {
                $('.jbdtlId').val('0');
                $("#tourDetailsBox").modal("show");
                $("#TourDetailsForm")[0].reset();
            });

            function populate(frm, data) {
                $.each(data, function (key, value) {
                    $('[name=' + key + ']', frm).val(value);
                });
                $('.sector').select2();
            }

            function getUserTourDetails(e) {
                var id = e.getAttribute('data-id');
                var mstNo = e.getAttribute('data-mst');
                $('.jbdtlId').val(id);
                $.ajax({
                    url: "/route/JBRKTourDetails/getDataNewJourney",
                    type: "get",
                    data: {
                        id: id
                    },
                    success: function (result) {

                        var F_TRANNO = '&nbsp;&nbsp;&nbsp;&nbsp;Tran No :- ' + result.data.F_TRANNO;
                        $("#topF_TRANNO").html(F_TRANNO);

                        var iddata = {
                            id: result.data._id
                        }
                        $.when($('#TourDetailsForm').populate(result.data)).done(function (x) {

                        });
                        $('#tourDetailsBox').modal('show');

                    }
                })
            }

            function deleteTourDetails(id) {

                var id = id.getAttribute('data-id');

                if (window.confirm("Do You Really Want To Delete")) {
                    $.ajax({
                        url: "/route/JBRKTourDetails/deleteTourDetails",
                        type: "POST",
                        data: {
                            id: id,
                        },

                        success: function (result) {
                            console.log("resultresultresultresult", result)
                            DrawTableInquiry1.ajax.reload();
                            alert("Deleted SuccessFully");

                        }
                    })
                }
            }



            //-------------------------------END TOUR DETAILS--------------------------------------
        </script>


        <% include ../partials/footer %>