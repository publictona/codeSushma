<% include ../partials/head %>
    <% include ../partials/header %>

        <style>
            @media print {
                .title-print {
                    display: block;
                    text-align: center;
                }
            }

            .title-print {
                display: none;
            }

            .header-title {
                color: #fff;
                margin-bottom: 0px;
            }

            .dataTables_wrapper {
                margin-top: -59px !important;
            }

            .print-btn {
                position: absolute;
                right: 51px;
                top: 10px;
                border: 1px solid #4f4f4f;
                border-radius: 2px;
            }

            .form-group {
                margin-bottom: 25px;
            }

            .uppercase {
                text-transform: uppercase;
            }

            /* ------tab s------ */
            body {
                margin: 0;
                padding: 0;
                height: 100%;
                background-color: #eaeeed;
                font-family: 'sans-serif', sans-serif;
            }

            .tab-container {
                margin: 5% 10%;
                background-color: #b7bbba;
                padding: 3%;
                border-radius: 4px;
            }

            .tab-menu {}

            .tab-menu ul {
                margin: 0;
                padding: 0;
            }

            .tab-menu ul li {
                list-style-type: none;
                display: inline-block;
            }

            .tab-menu ul li a {
                text-decoration: none;
                color: #333;
                background-color: #e0e6e4;
                padding: 7px 25px;
                border-radius: 4px;
                margin-left: 10px;
            }

            .tab-menu ul li a.active-a {
                background-color: #777;
                color: #ffffff;
                font-weight: bold;
            }

            .tab {
                display: none;
            }

            .tab h2 {
                color: rgba(0, 0, 0, .7);
            }

            .tab p {
                color: rgba(0, 0, 0, 0.6);
                text-align: justify;
            }

            .tab-active {
                display: block;
            }

            .tab .badge {
                margin-right: 5px;
            }

            #uspList_wrapper table,
            #uspList_wrapper .dataTables_scrollHeadInner {
                width: 100% !important;
            }

            .spa-loc .checkbox>input[type=checkbox] {
                left: 10px !important;
                top: 10px !important;
                opacity: 1 !important;
            }

            .btn-group,
            .btn-group-vertical {
                display: block;
            }


            element.style {}

            .newsearch {
                display: flex;
                align-items: flex-end;
            }

            /* -----e----- */
        </style>

        <!--Start of tab-menu-->
        <div class="tab-menu">
            <ul>
                <li><a href="#" class="tab-a active-a" data-id="tab1" onclick="test1()"> Courier</a></li>
                <li><a href="#" class="tab-a" data-id="tab2" onclick="test2()"> Master </a></li>

            </ul>
        </div>
        <!--end of tab-menu-->
        <br>
        <!---------------------- tab 1----------------------------------------- -->

        <div class="tab tab-active" data-id="tab1">
            <div class="col-sm-12 mb-3">
                <button class="btn btn-primary" id="add_New_Details">
                    Add Courier Details
                </button>
            </div>
            <!-- Table start -->

            <!-- for Filter  -->

            <div class="card">
                <div class="card-body">
                    <!-- filter s -->
                    <div class="col-sm-12">
                        <form id="frm_grid_search" name="frm_grid_search" style="display: block;" autocomplete="OFF">
                            <div class="card-body">

                                <div class="row align-items-center">
                                    <div class="col-md-2">
                                        <label class="fs12--design"> From Date </label>
                                        <input type="text" name="fromDt" class="form-control date-picker fromDt"
                                            id="fmdt" autocomplete="off" placeholder="DD/MM/YYYY">

                                    </div>
                                    <div class="col-md-2">
                                        <label class="fs12--design"> To Date </label>
                                        <input type="text" name="toDt" class="form-control date-picker toDt" id="todt"
                                            autocomplete="off" placeholder="DD/MM/YYYY">

                                    </div>

                                    <div class="col-md-2">
                                        <label class="fs12--design"> Courier Agency </label>
                                        <select class="form-control courierCode" id="code">
                                            <option value=""></option>
                                        </select>

                                    </div>

                                    <div class="col-md-2">
                                        <button type="submit" class="btn btn-primary btn-guest btn-block"
                                            onclick="getCourierSummary(this)">Summary</button>
                                    </div>

                                    <div class="col-md-2">
                                        <button type="submit" class="btn btn-primary btn-guest btn-block"
                                            onclick="courierDetailsData(this)"> Details</button>
                                    </div>



                                    <div class="col-md-12 printdata">
                                        <div class="col-md-12 infotxt">
                                        </div>

                                        <div class="col-md-5">
                                            <table
                                                class="table table-bordered table-striped display nowrap order-column addtr"
                                                border="1" cellpadding="5" cellspacing="0" style="width:100%;">
                                            </table>
                                        </div>

                                    </div>

                                </div>
                            </div>

                        </form>
                    </div>
                    <!-- filter end -->
                    <div class="col-sm-12">
                        <table class="table table-bordered table-striped" id="detailTable">
                            <thead>
                                <div class="col-sm-12"></div>


                                <div class="col-md-12 r-col">
                                    <table id="uspList"
                                        class="table table-bordered table-striped display nowrap order-column"
                                        style="width:100%;">
                                        <tbody class="appar">
                                        </tbody>
                                    </table>
                                </div>

                                <tr class="text-center justify-content-center">
                                </tr>
                            </thead>
                            <tbody id="insertData"></tbody>
                        </table>
                    </div>


                </div>
            </div>

            <!-- -----filter END------------- -->

            <!-- Table end -->

            <!-- MODAL START -->
            <div class="modal fade" id="addModelData" tabindex="-1" role="dialog" aria-hidden="true">
                <div class="modal-dialog modal-md">
                    <div class="modal-content">
                        <!-- Modal Header -->
                        <div class="modal-header">
                            <h5 class="modal-title"></h5>
                            <button type="button" class="close" data-dismiss="modal">
                                <span>×</span>
                            </button>
                        </div>
                        <!-- Modal body -->
                        <form id="newFormData" action="/route/courier/create" autocomplete="off" method="POST">
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group m-0">
                                            <input type="hidden" class="tranNo" name="tranNo" value="0">
                                        </div>

                                        <div class="form-group row col-sm-12">
                                            <label for="" class="col-sm-4 col-form-label fs15--design">Courier
                                            </label>

                                            <div class="col-sm-8">
                                                <select class="form-control courierCode" name="courierCode" required>
                                                    <option value=""></option>
                                                </select>
                                            </div>

                                        </div>

                                        <div class="form-group row col-sm-12">
                                            <label for="" class="col-sm-4 col-form-label fs15--design">Location

                                            </label>
                                            <div class="col-sm-8">
                                                <select class="form-control location" name="location" id="location"
                                                    required>
                                                    <option value=""></option>
                                                </select>

                                            </div>
                                        </div>

                                        <div class="form-group row col-sm-12">
                                            <label for="" class="col-sm-4 col-form-label fs15--design">Description
                                            </label>
                                            <div class="col-sm-8">
                                                <textarea type="text" class="form-control description"
                                                    name="description"></textarea>

                                            </div>
                                        </div>

                                        <div class="form-group row col-sm-12">
                                            <label for="" class="col-sm-4 col-form-label fs15--design"> Boxes
                                            </label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control noOfBox" name="noOfBox" />
                                            </div>
                                        </div>

                                        <div class="form-group row col-sm-12">
                                            <label for="" class="col-sm-4 col-form-label fs15--design">Charges(Rs) <span
                                                    style="color: rgb(128, 8, 8);">*</span></label>
                                            <div class="col-sm-8">
                                                <input type="number" class="form-control charges" name="charges"
                                                    required />
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="alert alert-success alert-dismissible fade show alert-hidden"
                                    id="successAlertAddTherapy">
                                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                        <span aria-hidden="true">×</span>
                                    </button>
                                    <strong>Success! </strong> Record added successfully.
                                </div>

                                <div class="alert alert-info alert-dismissible fade show alert-hidden"
                                    id="successAlertUpdateTherapy">
                                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                    <strong>Success! </strong> Record Update successfully.
                                </div>
                                <div class="alert alert-danger alert-dismissible fade show d-none"
                                    id="success-alert-error">
                                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                        <span aria-hidden="true">×</span>
                                    </button>
                                    <strong>Error! </strong> <span class="custom_error"></span>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="submit" class="btn btn-primary btn-block buttonSubmitFire">Submit</button>
                                <button type="reset" class="btn btn-primary buttonReset">Reset</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

        </div>

        <!---------------------- Summary Courier Details ------------------------------------>

        <div id="courierSummaryModel" class="modal fade" role="dialog">
            <div class="modal-dialog modal-dialog modal-md">

                <div class="modal-content">

                    <div class="modal-header modal-otp-header">
                        <h5 class="header-title">Courier Summary Details</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span> </button>
                    </div>
                    <br>
                    <div class="print-btn"><i class="fa fa-print btn btn-primary"
                            onclick="getCourierSummaryPrint(this)"></i>
                    </div>

                    <div class="modal-body">

                        <table id="courierSummaryTable" class="table table-bordered table-striped"
                            style="width:100%; border: 1px solid gray; border-collapse: collapse;">

                            <tbody>

                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
        </div>

        <!---------------------- courier  Details ------------------------------------>

        <div id="courierModel" class="modal fade" role="dialog">
            <div class="modal-dialog modal-dialog modal-lg">

                <div class="modal-content">

                    <div class="modal-header modal-otp-header">
                        <h5 class="header-title">Courier Details</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span> </button>
                    </div>
                    <br>
                    <div class="print-btn"><i class="fa fa-print btn btn-primary" onclick="detailPrint(this)"></i>
                    </div>

                    <div class="modal-body">

                        <table id="courierTable" class="table table-bordered table-striped"
                            style="width:100%; border: 1px solid gray; border-collapse: collapse;">

                            <tbody>

                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
        </div>

        <!-- MODAL END -->
        <!---------------------- tab 1 end----------------------------------------- -->

        <!---------------------- tab 2----------------------------------------- -->
        <div class="tab " data-id="tab2">
            <div class="row">
                <div class="col-md-5">
                    <div class="row">
                        <div class="col-md-12">
                            <h3 class="modal-title" style="width: 100%; color: #f3b63b;"><strong>Courier Master
                                </strong>
                            </h3>
                            <form id="newFormData1" action="/route/courierMaster/create" autocomplete="off"
                                method="POST">
                                <div class="modal-body">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="form-group m-0">
                                                <input type="hidden" class="courierMasterTran" name="tranNo" value="0">
                                            </div>

                                            <div class="form-group row col-sm-12">
                                                <label for="" class="col-sm-3 col-form-label fs15--design">
                                                    Name
                                                    <span style="color: rgb(117, 8, 8);">*</span>
                                                </label>

                                                <div class="col-sm-9">
                                                    <input type="text" class="form-control courierAgencyName"
                                                        name="courierAgencyName" placeholder="Enter Courier Agency Name"
                                                        required />
                                                </div>
                                            </div>


                                            <div class="form-group row col-sm-12">
                                                <label for="" class="col-sm-3 col-form-label fs15--design">Address

                                                </label>
                                                <div class="col-sm-9">
                                                    <textarea type="text" class="form-control address"
                                                        name="address"></textarea>
                                                </div>
                                            </div>



                                            <div class="form-group row col-sm-12">
                                                <label for="" class="col-sm-3 col-form-label fs15--design">Place
                                                </label>
                                                <div class="col-sm-9">
                                                    <input type="text" class="form-control place" name="place" />

                                                </div>
                                            </div>

                                            <div class="form-group row col-sm-12">
                                                <label for="" class="col-sm-3 col-form-label fs15--design"> Contact 1
                                                    <span style="color: rgb(117, 9, 9);">*</span>
                                                </label>
                                                <div class="col-sm-9">
                                                    <input type="number" class="form-control contact" name="contact"
                                                        minlength="10" maxlength="10"
                                                        title="Mobile number must have exactly 10 digits." required />
                                                </div>
                                            </div>
                                            <div class="form-group row col-sm-12">
                                                <label for="" class="col-sm-3 col-form-label fs15--design"> Contact 2

                                                </label>
                                                <div class="col-sm-9">
                                                    <input type="number" class="form-control contact2" name="contact2"
                                                        minlength="10" maxlength="10"
                                                        title="Mobile number must have exactly 10 digits." />
                                                </div>
                                            </div>

                                            <div class="form-group row col-sm-12">
                                                <label for="" class="col-sm-3 col-form-label fs15--design">kgs/Box
                                                </label>
                                                <div class="col-sm-9">
                                                    <select class="form-control kgsBox" name="kgsBox" required>
                                                        <option value="Select">Select</option>
                                                        <option value="KGS">KGS</option>
                                                        <option value="Box">Box</option>
                                                    </select>

                                                </div>
                                            </div>


                                            <div class="form-group row col-sm-12">
                                                <label for="" class="col-sm-3 col-form-label fs15--design">Rate
                                                </label>
                                                <div class="col-sm-9">
                                                    <input type="text" class="form-control rate" name="rate" />
                                                </div>
                                            </div>


                                        </div>
                                    </div>

                                    <div class="alert alert-success alert-dismissible fade show alert-hidden"
                                        id="successAlertAddTherapy">
                                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                            <span aria-hidden="true">×</span>
                                        </button>
                                        <strong>Success! </strong> Record added successfully.
                                    </div>

                                    <div class="alert alert-info alert-dismissible fade show alert-hidden"
                                        id="successAlertUpdateTherapy">
                                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                        <strong>Success! </strong> Record Update successfully.
                                    </div>
                                    <div class="alert alert-danger alert-dismissible fade show d-none"
                                        id="success-alert-error">
                                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                            <span aria-hidden="true">×</span>
                                        </button>
                                        <strong>Error! </strong> <span class="custom_error"></span>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="submit"
                                        class="btn btn-primary btn-block buttonSubmitFire">Submit</button>
                                    <button type="reset" class="btn btn-primary buttonReset">Reset</button>
                                </div>
                            </form>
                        </div>
                    </div>

                </div>
                <div class="col-md-7">
                    <table id="uspList2" class="table table-bordered table-striped display nowrap"></table>

                </div>
            </div>
        </div>
        <!---------------------- tab 2 end----------------------------------------- -->

        <!---------------------------------------- Courier Script1 ---------------------------------------->

        <script type="text/javascript">

            $(document).ready(function (e) {
                $('#validity').daterangepicker({
                    locale: {
                        format: 'DD/MM/YYYY'
                    },
                    startDate: moment().startOf('month'),
                    endDate: moment().endOf('month'),
                    ranges: {
                        'Today': [moment(), moment()],
                        'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                        'Last 7 Days': [moment().subtract(6, 'days'), moment()],
                        'Last 30 Days': [moment().subtract(29, 'days'), moment()],
                        'This Month': [moment().startOf('month'), moment().endOf('month')],
                        'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month')
                            .endOf('month')
                        ]
                    }
                });

                getBranchCode();
                getCourierDatas();
                getCourierLocDatas();
                getData();
                $(document).on("click", "#add_New_Details", function () {
                    $("#addModelData").modal("show");
                    $(".tranNo").val('0');
                    $(".modal-title").html("Add New Courier Details");
                    $(".buttonSubmitFire").html("SUBMIT");
                    $(".buttonReset").html("RESET");
                    $("#newFormData")[0].reset();
                    //$('#code').val();
                    DrawTableInquiry.ajax.reload();
                    //test1()
                    getCourierDatas();
                    getCourierLocDatas();


                });

                $(document).on("click", "#getSummaryData", function () {
                    $("#courierSummaryModel").modal("show");

                });

                $('.tab-a').click(function () {
                    $(".tab").removeClass('tab-active');
                    $(".tab[data-id='" + $(this).attr('data-id') + "']").addClass("tab-active");
                    $(".tab-a").removeClass('active-a');
                    $(this).parent().find(".tab-a").addClass('active-a');
                });

                var dataColumns = [
                    {
                        data: "tranNo",
                        sTitle: "Tran#",
                        visible: true,
                        className: "col-form-label fs15--design column-50",
                    },

                    {
                        data: "tranDt",
                        sTitle: "Date#",
                        visible: true,
                        className: "col-form-label fs15--design column-100",
                        render: function (data, type, row) {
                            return dateFormat(row.tranDt);
                        }
                    },

                    {
                        data: "courierCode",
                        sTitle: "Courier#",
                        visible: true,
                        className: "col-form-label fs15--design column-150",
                    },

                    {
                        data: "location",
                        sTitle: "Location#",
                        visible: true,
                        className: "col-form-label fs15--design column-100",
                    },

                    {
                        data: "noOfBox",
                        sTitle: "Box#",
                        visible: true,
                        className: "col-form-label fs15--design column-50",
                    },

                    {
                        data: "description",
                        sTitle: "Description#",
                        visible: true,
                        className: "col-form-label fs15--design column-250",
                    },

                    {
                        data: "charges",
                        sTitle: "Charges(Rs)",
                        visible: true,
                        className: "col-form-label fs15--design column-70",
                    },

                    {
                        data: "update",
                        sTitle: "Action",
                        visible: true,
                        className: "col-form-label fs15--design column-50",
                        render: function (data, type, row) {

                            var html =
                                ' <span class="btn btn-primary btn-block " data-id="' + row
                                    .tranNo +
                                '" onclick="updateMaster(this) " > EDIT </span>';
                            return html;
                        }
                    },
                ];

                DrawTableInquiry = DrawCustomDataTable("uspList", 350,
                    "/route/courier/grid-Data", dataColumns, [
                    [0, "asc"]
                ], "frm_grid_search", null, true, true);

                $("#frm_grid_search").validate({
                    errorPlacement: function (error, element) { },
                    submitHandler: function (form) {
                        DrawTableInquiry.ajax.reload();
                    }
                });

                $("#newFormData").validate({
                    rules: {
                    },
                    errorPlacement: function (error, element) { },
                    submitHandler: function (form) {
                        $(".overlay").show();
                        var formDom = $(form);
                        var formData = formDom.serializeObject();

                        $.ajax({
                            method: "POST",
                            url: "/route/courier/create",
                            data: JSON.stringify(formData),
                            contentType: "application/json; charset=utf-8",
                            dataType: "json",
                            success: function (result) {

                                $("#addModelData").modal("hide");
                                DrawTableInquiry.ajax.reload();
                                getData();
                            }
                        });
                    }
                });
            });

            function getData() {
                $.ajax({
                    method: "get",
                    url: "/route/courier/getData",
                    data: JSON.stringify({}),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (result) {
                        var str = ``;
                        for (var i = 0; i < result.Data.length; i++) {
                            str += `
                        <tr class="text-center justify-content-center" > 
                          <td class="align-middle font-weight-bold text-st-purple"> <span data-id="${result.Data[i].tranNo}" onclick="updateMaster(this)"> ${result.Data[i].ship_brn} </span> </td>
                       
                          <td class="align-middle"> ${result.Data[i].tranDt}</td> 
                          <td class="align-middle"> ${result.Data[i].tranId}</td>
                          <td class="align-middle"> ${result.Data[i].courierCode}</td>
                          <td class="align-middle"> ${result.Data[i].branch}</td>
                          <td class="align-middle"> ${result.Data[i].location}</td>
                          <td class="align-middle"> ${result.Data[i].noOfBox}</td>
                          <td class="align-middle"> ${result.Data[i].description}</td>
                          <td class="align-middle"> ${result.Data[i].charges}</td>
                         
                          
                        </tr>
                    `;
                        }
                        $('#insertData').html(str);
                        $('#detailTable').dataTable();

                    },
                })
            };

            function updateMaster(e) {
                var id = e.getAttribute('data-id');

                var parent = e.parentNode.parentNode;
                var obj = {
                    tranNo: id
                };
                // alert(obj);
                $.ajax({
                    method: "POST",
                    url: "/route/courier/getDataById",
                    data: JSON.stringify(obj),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (result) {

                        $.when($('#newFormData').populate(result.Data)).done(function (e) { });
                        //$('.ship_tocity').attr('disabled', true);

                        $('#addModelData').modal('show');
                        $(".modal-title").html("Update courier Details");
                    }
                });
            };

            function getCourierDatas() {
                var tray_url = "/route/courier/getCourierData";
                $.getJSON(tray_url, function (data) {
                    var optionList1 = '<option value="">Select</option>';

                    for (var i = 0; i < data.data.length; i++) {

                        optionList1 += '<option value="' + data.data[i].courierAgencyName + '">' +
                            data.data[i].courierAgencyName + '</option>'
                    }
                    $('.courierCode').html(optionList1);
                    $('.courierCode').select2;


                });
            }

            function getCourierLocDatas() {
                var tray_url = "/route/courier/getCourierLocData";
                $.getJSON(tray_url, function (data) {

                    var optionList1 = '<option value="Select">Select</option>';

                    for (var i = 0; i < data.length; i++) {

                        optionList1 += '<option value="' + data[i] + '">' +
                            data[i] + '</option>'
                    }
                    $('.location').html(optionList1);
                    $('.location').select2;

                });
            }

            function test1() {
                DrawTableInquiry.ajax.reload();
            }

            function getCourierSummary() {
                var courierCode = $('#code').val();
                var fromDt = $('#fmdt').val();
                var toDt = $('#todt').val();
                const obj = { courierCode, fromDt, toDt };

                $.ajax({
                    url: "/route/courier/getDataSummary",
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify(obj),
                    success: function (result) {
                        //  console.log("result", result);

                        if (result.status) {
                            let str = '<h5 class="title-print" style="text-align:center;margin-bottom:5px; font-size:25px; margin-bottom:30px;"><strong>Courier Summary Details</strong></h5><thead><tr><th style="border: 1px solid gray; text-align:center;">SR NO</th><th style="border: 1px solid gray; text-align:center;">Courier Agency Name</th><th style="border: 1px solid gray; text-align:right;">Charges</th></tr></thead><tbody>';
                            if (result.data.documents) {
                                let serialNo = 1;
                                for (let i = 0; i < result.data.documents.length; i++) {
                                    str += `<tr>
                                    <td style="border: 1px solid gray; text-align:center;">${serialNo}</td>
                                    <td style="border: 1px solid gray; text-align:center;">${result.data.documents[i].courierCode}</td>
                                    <td style="border: 1px solid gray; text-align:right;">${result.data.documents[i].charges}</td>
                                </tr>`;
                                    serialNo++;
                                }
                                // Append the total amount row
                                str += `<tr>
                                <td colspan="2" style="border: 1px solid gray;"><strong>Total Amount</strong></td>
                                <td style="border: 1px solid gray; text-align:right;"><strong>${result.data.totalAmount}</strong></td>
                            </tr>`;
                            }
                            str += '</tbody>';
                            $('#courierSummaryTable').html(str);
                            $('#courierSummaryModel').modal('show');
                        } else {
                            alert(result.message);
                        }
                    },
                    error: function (xhr, status, error) {
                        console.error("An error occurred:", status, error);
                        alert("An error occurred while fetching data. Please try again.");
                    }
                });
            }

            function courierDetailsData() {
                // $('.divLoader').show();
                var courierCode = $('#code').val();
                var fromDt = $('#fmdt').val();
                var toDt = $('#todt').val();
                const obj = { courierCode, fromDt, toDt };

                $.ajax({
                    url: "/route/courier/getDataDetails",
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify(obj),
                    success: function (result) {

                        if (result.status) {
                            let str = '<h5 class="title-print" style="text-align:center;margin-bottom:5px;font-size:25px; margin-bottom:30px;"><strong>Courier  Details</strong></h5><thead><tr><th style="border: 1px solid gray; text-align:center;">SR NO</th><th style="border: 1px solid gray; text-align:center;">Courier Agency Name</th><th style="border: 1px solid gray; text-align:right;">Date</th><th style="border: 1px solid gray; text-align:center;">Location</th><th style="border: 1px solid gray; text-align:center;">Box</th><th style="border: 1px solid gray; text-align:right;">Description</th><th style="border: 1px solid gray; text-align:right;">Charges</th></tr></thead><tbody>';


                            if (result.data.documents) {
                                let serialNo = 1;
                                for (let i = 0; i < result.data.documents.length; i++) {
                                    str += `<tr>
                                    <td style="border: 1px solid gray; text-align:center;">${serialNo}</td>
                                    <td style="border: 1px solid gray; text-align:center;">${result.data.documents[i].courierCode}</td>
                                    <td style="border: 1px solid gray; text-align:right;">${dateFormat(result.data.documents[i].tranDt)}</td>
                                    <td style="border: 1px solid gray; text-align:center;">${result.data.documents[i].location}</td>
                                    <td style="border: 1px solid gray; text-align:right;">${result.data.documents[i].noOfBox}</td>
                                    <td style="border: 1px solid gray; text-align:center;">${result.data.documents[i].description}</td>
                                    <td style="border: 1px solid gray; text-align:right;">${result.data.documents[i].charges}</td>
                                
                                </tr>`;
                                    serialNo++;
                                }
                                // Append the total amount row
                                str += `<tr>
                                <td colspan="6" style="border: 1px solid gray;"><strong>Total Amount</strong></td>
                                <td style="border: 1px solid gray; text-align:right;"><strong>${result.data.totalAmount}</strong></td>
                            </tr>`;
                            }
                            str += '</tbody>';

                            $('#courierTable').html(str);
                            $('#courierModel').modal('show');
                        } else {
                            alert(result.message);
                        }



                    },
                    error: function (xhr, status, error) {
                        console.error("An error occurred:", status, error);
                        alert("An error occurred while fetching data. Please try again.");
                    }
                });
            }

            function detailPrint() {
                var divToPrint = document.getElementById("courierTable");
                // console.log("divToPrint", divToPrint)
                divToPrint.style.border = "1px";
                newWin = window.open("");
                newWin.document.write(divToPrint.outerHTML);
                newWin.print();
                newWin.close();
            };

            function getCourierSummaryPrint() {
                var divToPrint = document.getElementById("courierSummaryTable");
                //console.log("divToPrint", divToPrint)
                divToPrint.style.border = "1px";
                newWin = window.open("");
                newWin.document.write(divToPrint.outerHTML);
                newWin.print();
                newWin.close();
            };

        </script>

        <!---------------------------------------- master Script 2 ---------------------------------------->

        <script type="text/javascript">

            $(document).ready(function (e) {
                getData1();

                var dataColumns1 = [

                    {
                        data: "tranNo",
                        sTitle: "No",
                        visible: true,
                        className: "col-form-label fs13--design column-50",
                    },

                    {
                        data: "tranDt",
                        sTitle: "Date",
                        visible: false,
                        className: "col-form-label fs13--design column-100",
                        render: function (data, type, row) {
                            return dateFormat(row.tranDt);
                        }
                    },

                    {
                        data: "courierAgencyName",
                        sTitle: "Agency Name",
                        visible: true,
                        className: "col-form-label fs13--design column-150",
                    },

                    {
                        data: "address",
                        sTitle: "Address",
                        visible: true,
                        className: "col-form-label fs13--design column-200",
                    },

                    {
                        data: "place",
                        sTitle: "Place",
                        visible: true,
                        className: "col-form-label fs13--design column-150",
                    },

                    {
                        data: "contact",
                        sTitle: "Contact",
                        visible: false,
                        className: "col-form-label fs13--design column-100",
                    },

                    {
                        data: "contact2",
                        sTitle: "Mobile",
                        visible: false,
                        className: "col-form-label fs13--design column-100",
                    },

                    {
                        data: "kgsBox",
                        sTitle: "kgs/Box",
                        visible: true,
                        className: "col-form-label fs13--design column-60",
                    },

                    {
                        data: "rate",
                        sTitle: "Rate",
                        visible: true,
                        className: "col-form-label fs13--design column-90",
                    },

                    {
                        data: "update",
                        sTitle: "Action",
                        visible: true,
                        className: "col-form-label fs13--design column-60",
                        render: function (data, type, row) {

                            var html =
                                ' <span class="btn btn-primary btn-block " data-id="' + row
                                    .tranNo +
                                '" onclick="updateMaster1(this) " > EDIT </span>';
                            return html;
                        }
                    },


                ];

                DrawTableInquiry1 = DrawCustomDataTable("uspList2", 350,
                    "/route/courierMaster/grid-Data", dataColumns1, [
                    [0, "asc"]
                ], "frm_grid_search1", null, true, true);

                $("#frm_grid_search1").validate({
                    errorPlacement: function (error, element) { },
                    submitHandler: function (form) {
                        DrawTableInquiry1.ajax.reload();
                    }
                });

                $("#newFormData1").validate({
                    rules: {
                    },
                    errorPlacement: function (error, element) { },
                    submitHandler: function (form) {
                        $(".overlay").show();
                        var formDom = $(form);
                        var formData = formDom.serializeObject();

                        $.ajax({
                            method: "POST",
                            url: "/route/courierMaster/create",
                            data: JSON.stringify(formData),
                            contentType: "application/json; charset=utf-8",
                            dataType: "json",
                            success: function (result) {
                                if (result) {
                                    $(".courierMasterTran").val(0)
                                    DrawTableInquiry1.ajax.reload();
                                    $("#newFormData1")[0].reset();
                                    $(".modal-title").html("Add Courier Details");

                                    // getData1();
                                }
                            }
                        });
                    }
                });
            });

            function getData1() {
                $.ajax({
                    method: "get",
                    url: "/route/courierMaster/getData",
                    data: JSON.stringify({}),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (result) {
                        var str = ``;
                        for (var i = 0; i < result.Data.length; i++) {
                            str += `
                        <tr class="text-center justify-content-center" > 
                          <td class="align-middle font-weight-bold text-st-purple"> <span data-id="${result.Data[i].tranNo}" onclick="updateMaster1(this)"> ${result.Data[i].courierAgencyName} </span> </td>
                          
                          <td class="align-middle"> ${result.Data[i].address}</td>
                          <td class="align-middle"> ${result.Data[i].place}</td>
                          <td class="align-middle"> ${result.Data[i].contact}</td>
                          <td class="align-middle"> ${result.Data[i].kgsBox}</td>
                          <td class="align-middle"> ${result.Data[i].rate}</td>
                        </tr>
                    `;
                        }


                    },
                })
            };

            function updateMaster1(e) {
                var id = e.getAttribute('data-id');

                var parent = e.parentNode.parentNode;
                var obj = {
                    tranNo: id
                };
                // alert(obj);
                $.ajax({
                    method: "POST",
                    url: "/route/courierMaster/getDataById",
                    data: JSON.stringify(obj),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (result) {
                        $.when($('#newFormData1').populate(result.Data)).done(function (e) {

                            $(".modal-title").html("Update Courier Details");
                        });




                    }
                });
            };

            function test2() {
                DrawTableInquiry1.ajax.reload();
            }


        </script>


        <% include ../partials/footer %>