<% include ../partials/head %>
    <% include ../partials/header %>
    <link rel="stylesheet" href="/stylesheets/bootstrap-multiselect.css" type="text/css"/>
        <style>
            .form-group {
                margin-bottom: 25px;
            }

            .uppercase {
                text-transform: uppercase;
            }

            .spa-loc .select2-container--default {
                width: 100% !important;
            }

            #suppliercat,
            #amount {
                padding-left: 10px;
            }



            /* ------tab s------ */
            body {
                margin: 0;
                padding: 0;
                height: 100%;
                background-color: #eaeeed;
                font-family: 'sans-serif', sans-serif;
            }

            .tab-container {
                margin: 5% 10%;
                background-color: #b7bbba;
                padding: 3%;
                border-radius: 4px;
            }

            .tab-menu {
                
            }

            .tab-menu ul {
                margin: 0;
                padding: 0;
            }

            .tab-menu ul li {
                list-style-type: none;
                display: inline-block;
            }

            .tab-menu ul li a {
                text-decoration: none;
                color: #333;
                background-color: #e0e6e4;
                padding: 7px 25px;
                border-radius: 4px;
                margin-left: 10px;
            }

            .tab-menu ul li a.active-a {
                background-color: #777;
                color: #ffffff;
                font-weight: bold;
            }

            .tab {
                display: none;
            }

            .tab h2 {
                color: rgba(0, 0, 0, .7);
            }

            .tab p {
                color: rgba(0, 0, 0, 0.6);
                text-align: justify;
            }

            .tab-active {
                display: block;
            }

            .tab .badge {
                margin-right: 5px;
            }
            #uspList_wrapper table, #uspList_wrapper .dataTables_scrollHeadInner{
                width:100% !important;
            }

            .spa-loc .checkbox>input[type=checkbox]{
                left: 10px !important;
                top: 10px !important;
                opacity: 1 !important;
            }
            .btn-group, .btn-group-vertical{
                display: block;
            }
        
            /* -----e----- */
        </style>

        <!-- tab start -->



        <div class="tab-menu">
            <ul>
                <li><a href="#" class="tab-a active-a" data-id="tab1" onclick="test1()">Deal Transaction Module</a></li>
                <li><a href="#" class="tab-a" data-id="tab2"  onclick="test2()">Deal Master Module</a></li>

            </ul>
        </div><!--end of tab-menu-->
        <div class="tab tab-active" data-id="tab1">
            <br>
            <!-- deal Tran Html -->
            <!-- <div class="col-sm-12 mb-3">
                <button class="btn btn-primary" id="Add_New_dealTransaction_Details">
                    Add Deal Transaction Details
                </button>
            </div> -->

            <div id="printModal" class="modal fade" role="dialog">
                <div class="modal-dialog modal-dialog modal-lg">
                    <div class="modal-content">

                        <div class="modal-header modal-otp-header">
                            <h5>Print Deal Transaction List Details</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span> </button>

                        </div>
                        <div class="modal-body modal-body-otp" id="printBody">
                        </div>
                    </div>
                </div>
            </div>


            <div class="card">
                <div class="card-body">
                    <div class="col-sm-12">
                        <table class="table table-bordered table-striped" id="dealTransactionDetailTable">
                            <thead>
                                <div class="col-sm-12"></div>

                                <button class="btn btn-primary" id="Add_New_dealTransaction_Details">
                                    Add Deal Transaction Details
                                </button>
                                

                                <!-- //  <div class="col-md-6"> -->
                                <div class="col-md-12 r-col">
                                    <table id="uspListTran"
                                        class="table table-bordered table-striped display nowrap"
                                        style="width:100%;">
                                        <tbody class="appar">
                                        </tbody>
                                    </table>
                                </div>
                                <!-- </div> -->
                                <tr class="text-center justify-content-center"></tr>
                            </thead>
                            <tbody id="insertdealTransactionData"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <!-- Table end -->

            <!-- MODAL START -->
            <div class="modal fade" id="adddealTransactionModel" tabindex="-1" role="dialog" aria-hidden="true">
                <div class="modal-dialog modal-md">
                    <div class="modal-content">
                        <!-- Modal Header -->
                        <div class="modal-header">
                            <h5 class="modal-title"></h5>
                            <button type="button" class="close" data-dismiss="modal">
                                <span>×</span>
                            </button>
                        </div>
                        <!-- Modal body -->
                        <form id="dealTransactionForm" action="/route/dealTransaction/dealTransactionMaster"
                            autocomplete="off" method="POST">
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-md-12">

                                        <div class="form-group m-0">
                                            <input type="hidden" name="F_TRANNO" value="0">
                                        </div>

                                        <!-- <div class="form-group row col-sm-12">
                                            <label for="" class="col-sm-4 col-form-label fs15--design">Deal No
                                            </label>

                                            <div class="col-md-8">
                                                <input type="number" class="form-control F_DEALNO" 
                                                    name="F_DEALNO" autocomplete="off" >
                                            </div>
                                        </div> -->

                                        <h4><span id="codeid"></span></h4>
                                      

                                        <div class="form-group row col-sm-12">
                                            <input type="hidden" name="F_ACCTCDNO" value="0">
                                            <label for="" class="col-sm-4 col-form-label fs15--design">Account Code
                                            </label>

                                            <div class="col-sm-8">
                                                <select class="form-control F_ACCTCD" id="suppliercat" name="F_ACCTCD"
                                                    required>
                                                    <option value=""></option>
                                                </select>
                                            </div>
                                        </div>


                                        <div class="form-group row col-md-12">
                                            <label for="Date Of Request" class="col-sm-4 col-form-label fs15--design">
                                                Valid
                                                Between
                                            </label>

                                            <div class="col-md-4">
                                                <input type="date" class="form-control date-picker" id="dateNow"
                                                    placeholder="From" name="F_VLDDT1" autocomplete="off" >
                                            </div>
                                            <div class="col-md-4">
                                                <input type="date" class="form-control F_VLDDT2 date-picker"  id="dateNow1"
                                                    placeholder="To" name="F_VLDDT2" autocomplete="off" >
                                            </div>
                                        </div>

                                        <div class="form-group row col-sm-12">
                                            <label for="" class="col-sm-4 col-form-label fs15--design">Deal Amount
                                            </label>

                                            <div class="col-md-8">
                                                <input type="number" class="form-control" placeholder="Enter Amount"
                                                    name="F_DEALAMT" autocomplete="off" required>
                                            </div>
                                        </div>


                                        <div class="form-group row col-sm-12">
                                            <label for="" class="col-sm-4 col-form-label fs15--design">Amt Type </label>

                                            <div class="col-sm-8">
                                                <select class="form-control F_DEALFLG" id="amount" name="F_DEALFLG">

                                                    <option value="Select">Select</option>
                                                    <option value="Percent">Percent</option>
                                                    <option value="Lumsum">Lumsum</option>

                                                </select>
                                            </div>
                                        </div>

                                        <div class="form-group row col-sm-12">
                                            <label for="" class="col-sm-4 col-form-label fs15--design">SPA Location
                                            </label>

                                            <div class="col-sm-8 spa-loc">
                                                <select class="form-control F_SPALOCN" id="F_SPALOCN" name="F_SPALOCN[]"
                                                    multiple  >

                                                </select>
                                            </div>
                                        </div>

                                    </div>
                                </div>

                                <div class="alert alert-success alert-dismissible fade show alert-hidden"
                                    id="successAlertAddTherapy">
                                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                        <span aria-hidden="true">×</span>
                                    </button>
                                    <strong>Success! </strong> Record added successfully.
                                </div>

                                <div class="alert alert-info alert-dismissible fade show alert-hidden"
                                    id="successAlertUpdateTherapy">
                                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                    <strong>Success! </strong> Record Update successfully.
                                </div>
                                <div class="alert alert-danger alert-dismissible fade show d-none"
                                    id="success-alert-error">
                                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                        <span aria-hidden="true">×</span>
                                    </button>
                                    <strong>Error! </strong> <span class="custom_error"></span>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="submit" class="btn btn-primary btn-block buttonSubmitFire">Submit</button>
                                <button type="reset" class="btn btn-primary buttonReset">Reset</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <!-- deal tran html end -->
        </div>



        <div class="tab " data-id="tab2">
            <br>
          
            <!-- Table start -->
    
            <div id="printModal" class="modal fade" role="dialog">
                <div class="modal-dialog modal-dialog modal-lg">
                    <div class="modal-content">
    
                        <div class="modal-header modal-otp-header">
                            <h5>Print Deal Master Details</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span> </button>
    
                        </div>
                        <div class="modal-body modal-body-otp" id="printBody">
                        </div>
                    </div>
                </div>
            </div>
    
    
    
            <div class="card">
                <div class="card-body">
                    <div class="col-sm-12">
                        <table class="table table-bordered table-striped" id="shipmentDetailTable">
                            <thead>
                                <div class="col-sm-12"></div>
    
                                <button class="btn btn-primary" id="Add_New_Shipment_Details">
                                    Add Deal Master Details
                                </button>
                                <br>
    
                                <!-- //  <div class="col-md-6"> -->
                                <div class="col-md-12">
                                    <table id="uspList"
                                        class="table table-bordered table-striped display nowrap order-column"
                                        style="width:90%;">
                                        <tbody class="appar">
                                        </tbody>
                                    </table>
                                </div>
                                <!-- </div> -->
    
    
                                <tr class="text-center justify-content-center"> </tr>
                            </thead>
                            <tbody id="insertDealData"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <!-- Table end -->
    
            <!-- MODAL START -->
            <div class="modal fade" id="addDealModel" tabindex="-1" role="dialog" aria-hidden="true">
                <div class="modal-dialog modal-md">
                    <div class="modal-content">
                        <!-- Modal Header -->
                        <div class="modal-header">
                            <h5 class="modal-title"></h5>
                            <button type="button" class="close" data-dismiss="modal">
                                <span>×</span>
                            </button>
                        </div>
                        <!-- Modal body -->
                        <form id="shipmentForm" action="/route/dealMaster/dealMaster" autocomplete="off" method="POST">
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group m-0">
                                            <input type="hidden" class="tranNo" name="tranNo" value="0">
                                        </div>
    
                                        <div class="form-group row col-sm-12">
                                            <label for="" class="col-sm-4 col-form-label fs15--design">Acc Code <span style="color: rgb(148, 9, 9);">*</span></label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control" name="F_ACCTCD" oninput="this.value = this.value.toUpperCase();" minlength="3" 
                                                maxlength="3"
                                                   required />
                                            </div>
                                        </div>
    
                                        <div class="form-group row col-sm-12">
                                            <label for="" class="col-sm-4 col-form-label fs15--design">Acc Name <span style="color: rgb(148, 9, 9);">*</span></label>
                                                
                                            <div class="col-sm-8">
                                                <input type="text" name="F_ACCTNM" class="form-control" 
                                                    required>
                                            </div>
    
                                        </div>
    
                                        <div class="form-group row col-sm-12">
                                            <label for="" class="col-sm-4 col-form-label fs15--design">Mobile <span style="color: rgb(148, 9, 9);">*</span></label>
                                            <div class="col-sm-8">
                                                <input type="number" class="form-control" name="F_MOBILE"  minlength="10" 
                                                maxlength="10" required />
                                            </div>
                                        </div>
    
                                        <div class="form-group row col-sm-12">
                                            <label for="" class="col-sm-4 col-form-label fs15--design">Email <span style="color: rgb(148, 9, 9);">*</span></label>
                                            <div class="col-sm-8">
                                                <input type="email" class="form-control" 
                                                    name="F_EMAIL" required />
                                            </div>
                                        </div>
                                      
    
                                        <div class="form-group row col-sm-12">
                                            <label for="appt" class="col-sm-4 col-form-label fs15--design">Contact Name <span style="color: rgb(148, 9, 9);">*</span></label>
                                             
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control"  name="F_CTCNAME"
                                                    required />
                                            </div>
                                        </div>
    
                                    </div>
                                </div>
    
                                <div class="alert alert-success alert-dismissible fade show alert-hidden"
                                    id="successAlertAddTherapy">
                                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                        <span aria-hidden="true">×</span>
                                    </button>
                                    <strong>Success! </strong> Record added successfully.
                                </div>
    
                                <div class="alert alert-info alert-dismissible fade show alert-hidden"
                                    id="successAlertUpdateTherapy">
                                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                    <strong>Success! </strong> Record Update successfully.
                                </div>
                                <div class="alert alert-danger alert-dismissible fade show d-none" id="success-alert-error">
                                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                        <span aria-hidden="true">×</span>
                                    </button>
                                    <strong>Error! </strong> <span class="custom_error"></span>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="submit" class="btn btn-primary btn-block buttonSubmitFire">Submit</button>
                                <button type="reset" class="btn btn-primary buttonReset">Reset</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <!-- MODAL END -->

  </div>
  <script type="text/javascript" src="/javascripts/bootstrap-multiselect.js"></script>

        <!-- Tab End -->

        <!-- MODAL END -->
        
        <script type="text/javascript">
            var DrawTableInquiry,DrawTableInquiry1;

            function test1(){
                DrawTableInquiry.ajax.reload();  
            }
            function test2(){
                DrawTableInquiry1.ajax.reload();  
            }

            $(document).ready(function (e) {
                // $("#F_SPALOCN").multiselect({enableCaseInsensitiveFiltering: true,maxHeight: 250});
                getBranchCode();
                getAccountCode();

                $(document).on("click", "#Add_New_dealTransaction_Details", function () {
                    $("#adddealTransactionModel").modal("show");
                    $(".F_TRANNO").val('0');
                    $(".F_ACCTCDNO").val('0');
                    $(".modal-title").html("Add New Deal Transaction Details");
                    $(".buttonSubmitFire").html("SUBMIT");
                    $(".buttonReset").html("RESET");
                    $("#dealTransactionForm")[0].reset();
                    $("#dateNow").val(Date());
                    $("#dateNow1").val(Date());
                });

                // $(document).ready(function () {
                   
                    $('.tab-a').click(function () {
                        $(".tab").removeClass('tab-active');
                        $(".tab[data-id='" + $(this).attr('data-id') + "']").addClass("tab-active");
                        $(".tab-a").removeClass('active-a');
                        $(this).parent().find(".tab-a").addClass('active-a');
                    });
              //  });



                var dataColumns = [{
                    data: "F_TRANNO",
                    sTitle: "F_TRANNO",
                    visible: true
                },            

                {
                    data: "F_TRANDT",
                    sTitle: "Date",
                    visible: true,
                    className: "fs15--design",
                    render: function (data, type, row) {
                        var html = " ";
                        return dateFormat(row.F_VLDDT1);
                    }
                },
                {
                    data: "F_ACCTCD",
                    sTitle: "Acc Code",
                    visible: true,
                    className: "fs15--design ",
                },

                {
                    data: "F_DEALNO",
                    sTitle: "Deal No",
                    visible: true,
                    className: "fs15--design",
                },

                {
                    data: "F_VLDDT1",
                    sTitle: "Valid Dt1",
                    visible: true,
                    className: "fs15--design",
                    render: function (data, type, row) {
                        var html = " ";
                        return dateFormat(row.F_VLDDT1);
                    }

                },
                {
                    data: "F_VLDDT2",
                    sTitle: "Valid Dt2",
                    visible: true,
                    className: "fs15--design",
                    render: function (data, type, row) {
                        var html = " ";
                        return dateFormat(row.F_VLDDT2);
                    }
                },

                {
                    data: "F_DEALAMT",
                    sTitle: "Deal Amt",
                    visible: true,
                    className: "fs15--design",
                },
                {
                    data: "F_DEALFLG",
                    sTitle: " Deal Type",
                    visible: true,
                    className: "fs15--design",
                },
                {
                    data: "F_SPALOCN",
                    sTitle: "Spa Location",
                    visible: true,
                    className: "fs15--design",
                },

           
                {
                    data: "update",
                    sTitle: "Action",
                    visible: true,
                    render: function (data, type, row) {

                        var html =
                            ' <span class="btn btn-primary btn-block " data-id="' + row
                                .F_TRANNO +
                                '" data-code="' + row.F_DEALNO + '" onclick="updatedealTransactionMaster(this) " > EDIT </span>';
                        return html;

                    }
                },

              ];

                DrawTableInquiry = DrawCustomDataTable("uspListTran", 350,
                    "/route/dealTransaction/grid-Data", dataColumns, [
                    [0, "asc"]
                ], "frm_grid_search", null, true, true);

                $("#frm_grid_search").validate({
                    errorPlacement: function (error, element) { },
                    submitHandler: function (form) {
                        DrawTableInquiry.ajax.reload();
                    }
                });

                $("#dealTransactionForm").validate({
                    rules: {
                    },
                    errorPlacement: function (error, element) { },
                    submitHandler: function (form) {
                      
                        $(".overlay").show();
                        var formDom = $(form);
                        var formData = formDom.serializeObject();
                        // alert(formData)
                        /* post method */
                        $.ajax({
                            method: "POST",
                            url: "/route/dealTransaction/dealTransactionMaster",
                            data: JSON.stringify(formData),
                            contentType: "application/json; charset=utf-8",
                            dataType: "json",
                            success: function (result) {
                                console.log(result);
                                //alert('Successfully saved data');
                                
                                
                                DrawTableInquiry.ajax.reload();
                                $("#adddealTransactionModel").modal("hide");
                                getdealTransactionData();
                            }
                        });
                    }
                });
            });

           

            function getdealTransactionData() {
                // var code = id.getAttribute('data-code');
                // $('#codeid').text(code);
                $.ajax({
                    method: "POST",
                    url: "/route/dealTransaction/getdealTransactionrDocument",
                    data: JSON.stringify({}),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (result) {
                        var str = ``; 
                        console.log("resultresultresult", result)
                        for (var i = 0; i < result.Data.length; i++) {
                            str += ` 
                        <tr class="text-center justify-content-center" data-spa='${result.Data[i].spa}'> 
                          <td class="align-middle font-weight-bold text-st-purple"> <span data-id="${result.Data[i].F_TRANNO}" onclick="updatedealTransactionMaster(this)"> ${result.Data[i].F_ACCTCD} </span> </td>
                          <td class="align-middle"> ${result.Data[i].F_ACCTCDNO}</td>
                          <td class="align-middle"> ${result.Data[i].F_VLDDT1 !== null ? result.Data[i].F_VLDDT1 : ""}</td>
                          <td class="align-middle"> ${result.Data[i]?.F_VLDDT2}</td>
                          <td class="align-middle"> ${result.Data[i]?.F_DEALAMT}</td>
                          <td class="align-middle"> ${result.Data[i]?.F_DEALFLG}</td>
                          <td class="align-middle"> ${result.Data[i]?.F_SPALOCN}</td>
                          
                        </tr>
                    `;
                        }
                        // $("#accountCode").select2();
                        $('.branchCodeGlobal').select2();
                        $("#F_ACCTCD").select2();
                       // $("#F_SPALOCN").select2();
                       
                        $('#insertdealTransactionData').html(str);
                        $('#dealTransactionDetailTable').dataTable();
                        // console.log(str);
                    },
                })
            };

            getdealTransactionData();

            function updatedealTransactionMaster(e) {
                var id = e.getAttribute('data-id');
                var parent = e.parentNode.parentNode;
                var obj = {
                    F_TRANNO: id
                };
                var code = e.getAttribute('data-code');
                //console.log("code", code)
                $('#codeid').text(code);
                // alert(obj);
                $.ajax({
                    method: "POST",
                    url: "/route/dealTransaction/getdealTransactionDataById",
                    data: JSON.stringify(obj),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (result) {
                        //console.log(result);
                        $.when($('#dealTransactionForm').populate(result.Data)).done(function (e) {
                            $('.F_ACCTCD').attr('disabled', true);
                           // $("#F_SPALOCN").attr('disabled', true);
                            $("#F_SPALOCN").multiselect("refresh");
                         });
                        $('#adddealTransactionModel').modal('show');
                        $(".modal-title").html("Update deal Transaction Details");


                    }
                });
            };

            

            //get Data

            function getdealTransactionPrint(e) {
                $('.divLoader').show();
                var id = e.getAttribute('data-id');

                $.ajax({
                    url: '/route/dealTransaction/dealTransactionPrint/',
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify({ id: id }),
                    dataType: "json",

                    success: function (result) {
                        console.log(result);

                        $('#printBody').html(result.html);
                        $('#printModal').modal('show');
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        var result = jQuery.parseJSON(jqXHR.responseText);
                    }
                });
            }

            function getAccountCode() {
                $.get("/route/dealTransaction/getAccCode", function (result) {
                    var category_json = "";
                    if (result.length > 0) {
                        category_json = '<option value="">Select Account Code</option>'
                        for (var i = 0; i < result.length; i++) {
                            if (result[i] && result[i] != "" && result[i] != "XXXXXXXXXXXX") {
                                //  console.log(result[i],"result getsuppliercat hiii")
                                if (result[i]) {
                                    category_json += '<option value="' + result[i].toUpperCase() + '">' + result[i].toUpperCase() + '</option>';
                                }
                            }
                        }
                    } else {
                        category_json = "";
                    }
                    $('.F_ACCTCD').html(category_json);
                });
            }

            function getBranchCode() {

                var optionList = '';
                $.ajax({
                    url: "/route/spaLocationST/getLocationListNew",
                    type: "GET",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (filterResult) {
                        if (filterResult && filterResult.length > 0) {
                            optionList += '<option value="IN000">IN000-HO/ Mumbai Depot</option>';
                            $.each(filterResult, function (index, data) {

                                optionList += '<option value="' + data.ST_BRN + '">' + data.ST_BRN + '</option>';
                            });
                        }
                      //  console.log(optionList);
                        $("#F_SPALOCN").html(optionList);
                        $("#F_SPALOCN").multiselect({includeSelectAllOption: true,allSelectedText: 'All',enableCaseInsensitiveFiltering: true,maxHeight: 250 , numberDisplayed: 50});
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        alert("Error in loading branch data.Please refresh page.");
                    }
                });
            }
        
  </script>


<script type="text/javascript">

    $(document).ready(function (e) {
        getBranchCode();
        $(document).on("click", "#Add_New_Shipment_Details", function () {
            $("#addDealModel").modal("show");
            $(".tranNo").val('0');
            
            $(".modal-title").html("Add New Deal Details");
            $(".buttonSubmitFire").html("SUBMIT");
            $(".buttonReset").html("RESET");
            $("#shipmentForm")[0].reset();
            $("#dateNow").val(Date());
        });


        var dataColumns = [
        {
            data: "tranNo",
            visible: false,
           
        },
        {
            data: "F_ACCTCD",
            sTitle: "ACC Code",
            visible: true,
            className: "fs15--design",
        },

        {
            data: "F_ACCTNM",
            sTitle: "ACC Name",
            visible: true,
            className: "fs15--design",
        },

        {
            data: "F_MOBILE",
            sTitle: "Mobile",
            visible: true,
            className: "fs15--design",
           
        },
        {
            data: "F_EMAIL",
            sTitle: "Email",
            visible: true,
            className: "fs15--design",
        },

        {
            data: "F_CTCNAME",
            sTitle: "Contact Name",
            visible: true,
            className: "fs15--design",
        },

        {
            data: "update",
            sTitle: "Action",
            visible: true,
            render: function (data, type, row) {

                var html =
                    ' <span class="btn btn-primary btn-block " data-id="' + row
                        .tranNo +
                    '" onclick="updataDealMaster(this) " > EDIT </span>';
                return html;
            }
        },

     
        ];

        DrawTableInquiry1 = DrawCustomDataTable("uspList", 350,
            "/route/dealMaster/grid-Data", dataColumns, [
            [0, "asc"]
        ], "frm_grid_search", null, true, true);

        $("#frm_grid_search").validate({
            errorPlacement: function (error, element) { },
            submitHandler: function (form) {
                DrawTableInquiry1.ajax.reload();
            }
        });

        $("#shipmentForm").validate({
            rules: {
            },
            errorPlacement: function (error, element) { },
            submitHandler: function (form) {
                $(".overlay").show();
                var formDom = $(form);
                var formData = formDom.serializeObject();
                // alert(formData)
                /* post method */
                $.ajax({
                    method: "POST",
                    url: "/route/dealMaster/dealMaster",
                    data: JSON.stringify(formData),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (result) {
                       // console.log(result);
                        //alert('Successfully saved data');
                        $("#addDealModel").modal("hide");
                        DrawTableInquiry1.ajax.reload();
                        getDealData();
                    }
                });
            }
        });
    });

    function getDealData() {
        $.ajax({
            method: "POST",
            url: "/route/dealMaster/getDealDoc",
            data: JSON.stringify({}),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (result) {
                var str = ``;
                for (var i = 0; i < result.Data.length; i++) {
                    str += `
                <tr class="text-center justify-content-center" data-spa='${result.Data[i].spa}'> 
                  <td class="align-middle font-weight-bold text-st-purple"> <span data-id="${result.Data[i].tranNo}" onclick="updataDealMaster(this)"> ${result.Data[i].F_ACCTCD} </span> </td>
                  <td class="align-middle"> ${result.Data[i].F_ACCTNM}</td> 
                  <td class="align-middle"> ${result.Data[i].F_MOBILE}</td> 
                  <td class="align-middle"> ${result.Data[i].F_EMAIL}</td>
                  <td class="align-middle"> ${result.Data[i].F_CTCNAME}</td>
                  </tr>
            `;
                }
                $('#insertDealData').html(str);
                $('#shipmentDetailTable').dataTable();
                // console.log(str);
            },
        })
    };

    getDealData();

    function updataDealMaster(e) {
        var id = e.getAttribute('data-id');
      
        var parent = e.parentNode.parentNode;
        var obj = {
            tranNo: id
        };
        // alert(obj);
        $.ajax({
            method: "POST",
            url: "/route/dealMaster/getDealDataById",
            data: JSON.stringify(obj),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (result) {

                 $.when($('#shipmentForm').populate(result.Data)).done(function (e) { });
               

                $('#addDealModel').modal('show');
                $(".modal-title").html("Update Deal Master Details");
            }
        });
    };

</script>

        <% include ../partials/footer %>