<% include ../partials/head %>
    <% include ../partials/header %>

        <style>
            .pd-3 {
                padding-left: 10px;
            }

            .ui-autocomplete {
                z-index: 2147483647;
            }

            .contentRow {
                white-space: break-spaces !important;
            }

            .tourcode,
            .formno {
                text-transform: uppercase;
                font-size: 16px;
                font-weight: 800;
            }

            .tourname {
                font-size: 12px;
            }

            .tour-detials {
                font-size: 15px;
                white-space: nowrap;
            }

            .background-box {
                background: #dadada;
                padding: 1px 5px;
                border-radius: 4px;
            }

            .col-150 {
                min-width: 150px;
                max-width: 150px;
                width: 150px;
            }

            .col-50 {
                min-width: 50px;
                max-width: 50px;
                width: 50px;
            }

            .alert {
                width: auto;
                padding: 20px;
                font-size: 15px;
                top: 63px !important;
                right: 20px !important;
                z-index: 999999 !important;
            }

            .ibTable tr td {
                padding: 3px;
            }

            .calIpBox {
                border-bottom: 1px solid #fff;
            }

            label.error {
                display: block !important;
            }
        </style>




        <div class="box">
            <div class="box-header with-border with-hamburger">
                <a href="javascript:void(0);" class="box-header-hamburger-menu" onclick="openNav()">
                    <i class="fa fa-bars" aria-hidden="true"></i>
                </a>
                <h3 class="box-title"> Visa Consulate Fees</h3>
            </div>
            <div class="box-body">
                <div class="row gutter--3px">
                    <div class="col-md-12">
                        <span class="btn btn-primary" onclick="addNewUser()"><i class="fa fa-plus"></i> Add Visa
                            Consulate Fees
                        </span>
                    </div>
                    <div class="col-md-12 r-col">
                        <table id="uspList" class="table table-bordered table-striped display nowrap order-column"
                            style="width:100%;">
                            <tbody class="appar">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="newUserBox" tabindex="-1" role="dialog" aria-labelledby="newUserBox"
            aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">

                <div class="modal-content">
                    <div class="modal-header">Add Visa Consulate Fees Details

                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="regForm">
                            <div class="row gutter--3px">
                                <div class="col-md-12">
                                    <div class="row gutter--3px">



                                     <!-- <fieldset class="gutter--3px">  -->



                                        <div class="form-group col-md-3">
                                            <label for="Tour">COUNSULATE CODE </label>
                                            <!-- <input type="hidden" class="form-control _id" name="_id" value="0"> -->
                                            <input type="text" name="CONSUL_CD" id="CONSUL_CD"
                                                class="form-control required" placeholder="IND for INDIA">
                                        </div>


                                        <!-- <div class="form-group col-md-3">
                                            <label for="Tour"> VISA Type</label>
                                            <select name="F_VISATY" id="F_VISATY" class="form-control select2">
                                                <option value="Business">Business</option>
                                                <option value="Diplomatic">Diplomatic</option>
                                                <option value="Tourist">Tourist</option>
                                                <option value="Transit">Transit</option>
                                                <option value="Work Permit">Work Permit</option>
                                                <option value="Work VISA">Work VISA</option>
                                            </select>
                                        </div> -->

                                        <div class="form-group col-md-3">
                                            <label for="Tour"> VISA Type</label><span
                                            style="color: rgb(170, 4, 4); font-size: medium;">*</span>
                                            <select class="form-control F_VISATY" id="F_VISATY" name="F_VISATY" required>
                                                <option value=""></option>
                                              </select>
                                        </div>

                                        <div class="form-group col-md-3">
                                            <label for="Tour"> PP Holder</label><span
                                            style="color: rgb(170, 4, 4); font-size: medium;">*</span>
                                            <select class="form-control F_PPHOLD" id="F_PPHOLD" name="F_PPHOLD" required>
                                                <option value=""></option>
                                              </select>
                                        </div>

                                     <div class="form-group col-md-3">
                                            <label for="Tour">From Dt</label>
                                            <input type="text" name="F_FROMDT" id="F_FROMDT"
                                                class="form-control datepicker">
                                        </div>
                                        

                                        <div class="form-group col-md-3">
                                            <label for="Tour">Currency</label><span
                                            style="color: rgb(170, 4, 4); font-size: medium;">*</span>
                                            <select class="form-control F_CURCODE" id="F_CURCODE" name="F_CURCODE" required>
                                                <option value=""></option>
                                              </select>
                                        </div>







                                        <div class="form-group col-md-3">
                                            <div class="row no-margin gutter--3px">
                                                <div class="form-group col-md-6">
                                                    <label for="Tour">AGE</label>
                                                    <select class="form-control select2" name="F_AGE1" id="F_AGE1">
                                                        <% for(var i=0; i<155 ; i++) { %>
                                                            <option>
                                                                <%= i; %>
                                                            </option>
                                                            <% } %>
                                                    </select>
                                                </div>
                                                <div class="form-group col-md-6">
                                                    <label for="Tour">TO</label>
                                                    <select class="form-control select2" name="F_AGE2" id="F_AGE2">
                                                        <% for(var i=0; i<155 ; i++) { %>
                                                            <option>
                                                                <%= i; %>
                                                            </option>
                                                            <% } %>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group col-md-12" style='background-color:#a9a9a9;'>
                                            <center>
                                                <h5 class="text--white">FEES</h5>
                                            </center>
                                        </div>
                                        <div class="form-group col-md-2">
                                            <label for="Tour">&nbsp;</label><br>
                                            <b>SINGLE</b>
                                        </div>
                                        <div class="form-group col-md-2">
                                            <label for="Tour">Normal</label>
                                            <input type="text" name="F_NOR_S" id="F_NOR_S" class="form-control">
                                        </div>
                                        <div class="form-group col-md-2">
                                            <label for="Tour">Urgent</label>
                                            <input type="text" name="F_UCH_S" id="F_UCH_S" class="form-control">
                                        </div>
                                        <div class="form-group col-md-2">
                                            <label for="Tour">Add On CHG.</label>
                                            <input type="text" name="F_ADD_S" id="F_ADD_S" class="form-control">
                                        </div>
                                        <div class="form-group col-md-2">
                                            <label for="Tour">Re-Active</label>
                                            <input type="text" name="F_RAC_S" id="F_RAC_S" class="form-control">
                                        </div>
                                        <div class="form-group col-md-2">
                                            <label for="Tour">Re-Apply</label>
                                            <input type="text" name="F_RAP_S" id="F_RAP_S" class="form-control">
                                        </div>
                                        <div class="form-group col-md-2">
                                            <label for="Tour">&nbsp;</label><br>
                                            <b>DOUBLE</b>
                                        </div>
                                        <div class="form-group col-md-2">
                                            <label for="Tour">Normal</label>
                                            <input type="text" name="F_NOR_D" id="F_NOR_D" class="form-control">
                                        </div>
                                        <div class="form-group col-md-2">
                                            <label for="Tour">Urgent</label>
                                            <input type="text" name="F_UCH_D" id="F_UCH_D" class="form-control">
                                        </div>
                                        <div class="form-group col-md-2">
                                            <label for="Tour">Add On CHG.</label>
                                            <input type="text" name="F_ADD_D" id="F_ADD_D" class="form-control">
                                        </div>
                                        <div class="form-group col-md-2">
                                            <label for="Tour">Re-Active</label>
                                            <input type="text" name="F_RAC_D" id="F_RAC_D" class="form-control">
                                        </div>
                                        <div class="form-group col-md-2">
                                            <label for="Tour">Re-Apply</label>
                                            <input type="text" name="F_RAP_D" id="F_RAP_D" class="form-control">
                                        </div>
                                        <div class="form-group col-md-2">
                                            <label for="Tour">&nbsp;</label><br>
                                            <b>TRIPLE</b>
                                        </div>
                                        <div class="form-group col-md-2">
                                            <label for="Tour">Normal</label>
                                            <input type="text" name="F_NOR_T" id="F_NOR_T" class="form-control">
                                        </div>
                                        <div class="form-group col-md-2">
                                            <label for="Tour">Urgent</label>
                                            <input type="text" name="F_UCH_T" id="F_UCH_T" class="form-control">
                                        </div>
                                        <div class="form-group col-md-2">
                                            <label for="Tour">Add On CHG.</label>
                                            <input type="text" name="F_ADD_T" id="F_ADD_T" class="form-control">
                                        </div>
                                        <div class="form-group col-md-2">
                                            <label for="Tour">Re-Active</label>
                                            <input type="text" name="F_RAC_T" id="F_RAC_T" class="form-control">
                                        </div>
                                        <div class="form-group col-md-2">
                                            <label for="Tour">Re-Apply</label>
                                            <input type="text" name="F_RAP_T" id="F_RAP_T" class="form-control">
                                        </div>
                                        <div class="form-group col-md-2">
                                            <label for="Tour">&nbsp;</label><br>
                                            <b>MULTIPLE</b>
                                        </div>
                                        <div class="form-group col-md-2">
                                            <label for="Tour">Normal</label>
                                            <input type="text" name="F_NOR_M" id="F_NOR_M" class="form-control">
                                        </div>
                                        <div class="form-group col-md-2">
                                            <label for="Tour">Urgent</label>
                                            <input type="text" name="F_UCH_M" id="F_UCH_M" class="form-control">
                                        </div>
                                        <div class="form-group col-md-2">
                                            <label for="Tour">Add On CHG.</label>
                                            <input type="text" name="F_ADD_M" id="F_ADD_M" class="form-control">
                                        </div>
                                        <div class="form-group col-md-2">
                                            <label for="Tour">Re-Active</label>
                                            <input type="text" name="F_RAC_M" id="F_RAC_M" class="form-control">
                                        </div>
                                        <div class="form-group col-md-2">
                                            <label for="Tour">Re-Apply</label>
                                            <input type="text" name="F_RAP_M" id="F_RAP_M" class="form-control">
                                        </div>
                                        <div class="form-group col-md-2">
                                            <label for="Tour">&nbsp;</label><br>
                                            <b>ON ARRIVAL</b>
                                        </div>
                                        <div class="form-group col-md-2">
                                            <label for="Tour">Normal</label>
                                            <input type="text" name="F_NOR_O" id="F_NOR_O" class="form-control">
                                        </div>
                                        <div class="form-group col-md-2">
                                            <label for="Tour">Urgent</label>
                                            <input type="text" name="F_UCH_O" id="F_UCH_O" class="form-control">
                                        </div>
                                        <div class="form-group col-md-2">
                                            <label for="Tour">Add On CHG.</label>
                                            <input type="text" name="F_ADD_O" id="F_ADD_O" class="form-control">
                                        </div>
                                        <div class="form-group col-md-2">
                                            <label for="Tour">Re-Active</label>
                                            <input type="text" name="F_RAC_O" id="F_RAC_O" class="form-control">
                                        </div>
                                        <div class="form-group col-md-2">
                                            <label for="Tour">Re-Apply</label>
                                            <input type="text" name="F_RAP_O" id="F_RAP_O" class="form-control">
                                        </div>
                                        <div class="form-group col-md-12 view-days form-group1">
                                        </div>
                                         <!-- </fieldset>  -->
                                    </div>

                                </div>
                                <div class="col-md-12 mt-10">

                                    <button type="submit" class="btn btn-primary btn-block">SAVE</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>



        <script>

            var DrawTableInquiry;
            $(document).ready(function () {
               
               getVisaTypeData();
               getPpHolderData();
               getCurrData(); 

                var dataColumns = [{
                    data: "_id",
                    sTitle: "Id",
                    visible: false
                },

                // {
                //     data: "TRANNO",
                //     sTitle: "TRANNO#",
                //     visible: true,
                //     className: "fs14--design column-12",

                // },

                {
                    data: "F_VISATY",
                    sTitle: "F_VISATY#",
                    visible: true,
                    className: "fs14--design",

                },

                {
                    data: "F_PPHOLD",
                    sTitle: "F_PPHOLD#",
                    visible: true,
                    className: "fs14--design",

                },

                {
                    data: "F_FROMDT",
                    sTitle: "F_FROMDT#",
                    visible: true,
                    className: "fs14--design",
                    render: function (data, type, row) {
                        var html = "";
                        return dateFormat(row.F_FROMDT);
                    }

                },


                {
                    data: "F_AGE1",
                    sTitle: "F_AGE1#",
                    visible: true,
                    className: "fs14--design",

                },

                {
                    data: "F_AGE2",
                    sTitle: "F_AGE2#",
                    visible: true,
                    className: "fs14--design",

                },

                {
                    data: "F_CURCODE",
                    sTitle: "F_CURCODE#",
                    visible: true,
                    className: "fs14--design",

                },

                {
                    data: "F_NOR_S",
                    sTitle: "F_NOR_S#",
                    visible: true,
                    className: "fs14--design",

                },

                {
                    data: "F_NOR_D",
                    sTitle: "F_NOR_D#",
                    visible: true,
                    className: "fs14--design",
                   
                },
                {
                    data: "F_NOR_T",
                    sTitle: "F_NOR_D#",
                    visible: true,
                    className: "fs14--design",
                   
                },
                {
                    data: "F_NOR_M",
                    sTitle: "F_NOR_M#",
                    visible: true,
                    className: "fs14--design",
                   
                },
                {
                    data: "F_NOR_O",
                    sTitle: "F_NOR_O#",
                    visible: true,
                    className: "fs14--design",
                   
                },

                {
                    data: "F_NOR_O",
                    sTitle: "Arv#",
                    visible: true,
                    className: "fs14--design",
                   
                },

                {
                    data: "F_NOR_O",
                    sTitle: "Approve#",
                    visible: true,
                    className: "fs14--design",
                   
                },
                
                {
                    data: "VISA_FEE",
                    sTitle: "Action",
                    visible: true,
                    render: function (data, type, row) {
                        //console.log(row);
                        var html =
                            ' <span class="btn btn-primary btn-block" data-id="' + row
                                ._id +
                            '" onclick="getUser(this) "> Edit</span>';
                        return html;
                    }
                },

                ];

                DrawTableInquiry = DrawCustomDataTable("uspList", 350,
                    "/route/consulateFeesMaster/grid-data", dataColumns, [
                    [0, "asc"]
                ], "frm_grid_search", null, true, true);

                $("#frm_grid_search").validate({
                    errorPlacement: function (error, element) { },
                    submitHandler: function (form) {
                        DrawTableInquiry.ajax.reload();
                    }
                });
                $('.textUpper').on('keyup', function (e) {
                    $(this).val($(this).val().toUpperCase());
                });

                $("form#regForm").submit(function (e) {
                    //$('#newUserBox').modal('hide');
                    e.preventDefault();
                });

                $("#regForm").validate({
                    rules: {
                        //suppliercat: "required",
                    },
                    messages: {
                        //suppliercat: "Supplier Category is required",
                    },

                    errorPlacement: function (error, element) {
                        offset = element.offset();
                        error.insertAfter(element)
                        error.addClass('message');
                        error.css('display', 'block!important');
                        error.css('color', 'red');
                    },

                    submitHandler: function (form) {

                        $('#newUserBox').modal('hide');
                        var $form = $(form);
                        var formData = $form.serializeObject();

                        var method = "post";
                        var url = "/route/consulateFeesMaster/create";
                        console.log(formData.id);
                        if (formData.id != 0) {
                            url =
                                '/route/consulateFeesMaster/update/' +
                                formData.id;
                            method = "put";
                        }
                        $.ajax({
                            url: url,
                            type: method,
                            contentType: "application/json; charset=utf-8",
                            data: JSON.stringify(formData),
                            dataType: "json",

                            success: function (result) {
                                console.log("resultresultresult", result)
                                if (result.status) {
                                    notification({
                                        type: "success",
                                        message: result
                                            .msg
                                    });

                                    DrawTableInquiry.ajax
                                        .reload();
                                }
                            }
                        });
                    }
                });
            });

            function addNewUser() {
                $('#newUserBox').modal('show');
            }

            function populate(frm, data) {
                $.each(data, function (key, value) {
                    $('[name=' + key + ']', frm).val(value);
                });
                $('.sector').select2();
            }

            function getUser(id) {
                var id = id.getAttribute('data-id');
                $.ajax({
                    url: "/route/consulateFeesMaster/getData",
                    type: "get",
                    data: {
                        id: id
                    },
                    success: function (result) {

                        // var tranNO = '&nbsp;&nbsp;&nbsp;&nbsp;Tran No :- ' + result.data.tranNo;
                        // $("#topTranNo").html(tranNO);

                        var iddata = {
                            id: result.data._id
                        }
                        $.when($('#regForm').populate(result.data)).done(function (x) {

                        });



                        // ------
                        populate('#regForm', result.data);
                        populate('#regForm', iddata);

                        $('#newUserBox').modal('show');

                    }
                })
            }

            function openNav() {
                document.getElementById("mySidenav").style.width = "250px";
            }

            function closeNav() {
                document.getElementById("mySidenav").style.width = "0";
            }

        function getVisaTypeData() {
        $.get("/route/consulateFeesMaster/getVisaTypeData", function (result) {
            //console.log(result,"result hiii")
          var category_json = "";
          if (result.length > 0) {
            category_json = '<option value="">Select visa type</option>'
            for (var i = 0; i < result.length; i++) {
              if (result[i] && result[i] != "" && result[i] != "XXXXXXXXXXXX") {
               // console.log(result[i],"result hiii")this.F_NAME
                if (result[i]) {
                    category_json += '<option value="' + result[i].NRS_CODE1+ '">' + result[i].NRS_CODE1 + '</option>';
                }
              }
            }
         
          } else {
            category_json = "";
          }
          $('.F_VISATY').html(category_json);
        });
      }

      function getPpHolderData() {
        $.get("/route/consulateFeesMaster/getPpHoldData", function (result) {
          var category_json = "";
          if (result.length > 0) {
            category_json = '<option value="">Select pp holder</option>'
            for (var i = 0; i < result.length; i++) {
              if (result[i] && result[i] != "" && result[i] != "XXXXXXXXXXXX") {
                //console.log(result[i],"result hiii")
                if (result[i]) {
                  category_json += '<option value="' + result[i].NRS_CODE1 + '">' + result[i].NRS_CODE1 + '</option>';
                }
              }
            }
          } else {
            category_json = "";
          }
          $('.F_PPHOLD').html(category_json);
        });
      }

      function getCurrData() {
        $.get("/route/consulateFeesMaster/getCurrencyData", function (result) {
          var category_json = "";
          if (result.length > 0) {
            category_json = '<option value="">Select Currency</option>'
            for (var i = 0; i < result.length; i++) {
              if (result[i] && result[i] != "" && result[i] != "XXXXXXXXXXXX") {
               // console.log(result[i],"result hiii")//CUR_CODE
                if (result[i]) {
                  category_json += '<option value="' + result[i].CUR_CODE + '">' + result[i].CUR_CODE + '</option>';
                }
              }
            }
          } else {
            category_json = "";
          }
          $('.F_CURCODE').html(category_json);
        });
      }

   

        </script>
        <% include ../partials/footer %>