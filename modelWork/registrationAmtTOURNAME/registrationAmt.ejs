<% include ../partials/head %>
<% include ../partials/header %>
<style type="text/css">
    .visa__alert.alert {
        margin: 0 10px;
    }

    .visa__alert.alert .close {
        color: #fff;
        font-size: 15px;
        opacity: 1;
    }
</style>
<div class="row">
    <div class="col-md-3">
        <form id="frm-grid-search" name="frm-grid-search">
            <div class="box bgff">
                <label for="mice_branch">TOURCODE</label>
                <select class="form-control select2" name="TOURCODE" id="TOURCODE"></select>
            </div>
            <div class="box bgff">
                <label for="TOURNAME">TOURNAME</label>
                <select class="form-control select2 " name="TOURNAME" id="TOURNAME"></select>
            </div>
            <!-- <div class="box bgff">
                    <label for="country_list_visa">VISA</label>
                    <select class="form-control select2 " name="VISA_CAT" id="country_list_visa" ></select>
                </div> -->
            <div class="box bgff">
                <button type="submit" class="btn btn-primary btn-guest height-30" style="">SEARCH</button>
            </div>
        </form>
    </div>
    <div class="col-md-9">
        <div class="box box-primary">
            <div class="box-header with-border">
                <h3 class="box-title">Tour Series Visa Detail</h3>
            </div>
            <div class="box-body">
                <table id="tour_slide_table" class="table table-bordered table-striped display nowrap order-column grid-edit-row">
                    <tbody class="appar">
                    </tbody>
                </table>
            </div>
        </div>
        
    </div>
</div>




<div class="modal fade" id="tourSeriesVisaDetailsModel" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
    aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content gutter--3px third-sec">
            <form id="erp_form_vd" action="/route/TOURNAME/tourVisaDetailsUpdate/" autocomplete="off">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">X</span>
                    </button>
                    <h4 class="modal-title" id="myModalLabel">
                        TOUR SERIES VISA DETAILS
                    </h4>
                </div>
                <div class="modal-body">
                    <div class="form-group col-sm-6">
                        <label class="control-label" for="TOURCODE_VD">TOURCODE</label>
                        <div class="">
                            <input type="text" class="form-control" name="TOURCODE" id="TOURCODE_VD" placeholder="TOURCODE"
                                readonly="" />
                        </div>
                    </div>
                    <div class="form-group col-sm-6">
                        <label class="control-label" for="TOURNAME_VD">TOURNAME</label>
                        <div class="">
                            <input type="text" class="form-control" name="TOURNAME" id="TOURNAME_VD" placeholder="TOURNAME"
                                readonly="" />
                        </div>
                    </div>
                    <div class="form-group col-sm-6">
                        <label class="control-label" for="VISA_1_VD">VISA 1</label>
                        <div class="">
                            <input type="text" class="form-control" name="VISA_1" id="VISA_1_VD" placeholder="VISA_1" />
                        </div>
                    </div>
                    <div class="form-group col-sm-6">
                        <label class="control-label" for="VISA_2_VD">VISA 2</label>
                        <div class="">
                            <input type="text" class="form-control" name="VISA_2" id="VISA_2_VD" placeholder="VISA_2" />
                        </div>
                    </div>
                    <div class="form-group col-sm-6">
                        <label class="control-label" for="VISA_3_VD">VISA 3</label>
                        <div class="">
                            <input type="text" class="form-control" name="VISA_3" id="VISA_3_VD" placeholder="VISA_3" />
                        </div>
                    </div>
                    <div class="form-group col-sm-6">
                        <label class="control-label" for="VISA_4_VD">VISA 4</label>
                        <div class="">
                            <input type="text" class="form-control" name="VISA_4" id="VISA_4_VD" placeholder="VISA_4" />
                        </div>
                    </div>
                    <div class="form-group col-sm-6">
                        <label class="control-label" for="VISA_BKDAY_VD">VISA BKDAY</label>
                        <div class="">
                            <input type="text" class="form-control" name="VISA_BKDAY" id="VISA_BKDAY_VD" placeholder="VISA_BKDAY" />
                        </div>
                    </div>
                    <div class="form-group col-sm-6">
                        <label class="control-label" for="VISA_CUTOF_VD">VISA CUTOFF</label>
                        <div class="">
                            <input type="text" class="form-control" name="VISA_CUTOF" id="VISA_CUTOF_VD" placeholder="VISA_CUTOF" />
                        </div>
                    </div>
                    <div class="form-group col-sm-6">
                        <label class="control-label" for="AIRTKT_PNR_VD">AIR-TKT/PNR</label>
                        <div class="">
                            <input type="text" class="form-control" name="AIRTKT_PNR" id="AIRTKT_PNR_VD" placeholder="AIRTKT_PNR" />
                        </div>
                    </div>
                    <div class="form-group col-sm-6">
                        <label class="control-label" for="HOTEL_VOU_VD">HOTEL VOUCHER</label>
                        <div class="">
                            <input type="text" class="form-control" name="HOTEL_VOU" id="HOTEL_VOU_VD" placeholder="HOTEL_VOU" />
                        </div>
                    </div>
                    <!-- <div class="form-group">
                        <div class="col-sm-offset-2 col-sm-10">
                            <button type="submit" class="btn btn-default">SAVE</button>
                        </div>
                    </div> -->
                    <div class="clearfix"></div>
                </div>
                <div class="modal-footer">
                    <div>
                        <input type="hidden" class="form-control" name="AccessToken" value="<%= AccessToken %>" />
                    </div>
                    <div class="box-footer">
                        <button type="submit" class="btn btn-primary btn-guest button-submit-form btn-block" data-click="reset()"
                            id="submit">SAVE</button>
                    </div>
                    <!-- <div class="alert alert-success hide-alert-box" id="success-alert-vd">
                        <button type="button" class="close" data-dismiss="alert">x</button>
                        <strong>Success! </strong>
                        Record added successfully.
                    </div> -->
                    <div class="alert alert-success hide-alert-box text-center visa__alert" id="custom_success_vd">
                        <button type="button" class="close visa__close" data-dismiss="alert">x</button>
                        <strong>Success! </strong>
                        Record Update successfully.
                    </div>
                    <div class="alert alert-danger hide-alert-box text-center visa__alert" id="danger-alert-vd">
                        <button type="button" class="close visa__close" data-dismiss="alert">x</button>
                        <strong>Error! </strong>
                        <span class="custom_error"></span>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>



<script type="text/javascript">

    function PresentationDate(data) {
        if (data) {
            var year = data.substr(0, 4);
            var month = data.substr(5, 2);
            var mydate = data.substr(8, 2);
            var newDate = mydate + "/" + month + "/" + year;
            return newDate;
        }
    }

    function getTourcode() {
        $.ajax({
            url: "/route/TOURNAME/getTourSeries",
            type: "GET",
            contentType: "application/json; charset=utf-8",
            success: function (result) {
                result = JSON.parse(JSON.stringify(result));
                var options = '<option value="ALL">- SELECT -</option>';
                var tourmaneOptions = '<option value="ALL">- SELECT -</option>';
                for (var i = 0; i < result.length; i++) {
                    options += '<option value=' + result[i].TOURCODE + ' data-TOURCODE="' + result[i].TOURCODE + '">' + result[i].TOURCODE + '</option>';
                    tourmaneOptions += '<option value="' + result[i].TOURNAME + '" data-TOURCODE="' + result[i].TOURCODE + '">' + result[i].TOURNAME + '</option>';
                }
                $("#TOURCODE").html(options);
                $("#TOURCODE").select2();
                $("#TOURNAME").html(tourmaneOptions);
                $("#TOURNAME").select2();
            },
            error: function (jqXHR, textStatus, errorThrown) {
                alert("Error in loading branch data.Please refresh page");
            }
        });
    }

    // function visa_Country(){
    //     var len;
    //     $.get("/route/rsData/GET_COUNTRYCODE_VISA", function(data) {
    //         var country_json = '';
    //         if (data && data.length > 0) {
    //             if (data[i] && data[i] != "") {
    //                 country_json += '<input type="checkbox" class="VISA_FOR" name="sectors[]" value="' + data[i] + '">&nbsp;' + data[i] + '<br>';
    //             }
    //             $("#country_list_visa").html(country_json);
    //             $("#country_list_visa").select2();
    //         } else {}
    //     });
    // }



    $(document).ready(function () {
        getTourcode();
        var editGridData = "";

        $(document).on('click', '.editGridData', function () {
            $(".overlay").show();
            var id = $(this).attr("data-id");
            var url = "/route/TOURNAME/" + id;
            editGridData = id;
            $.get(url, {}, function (data) {
                populate_data = data;
                console.log(data);
                var formAction = "/route/TOURNAME/tourVisaDetailsUpdate/";
                formAction = formAction + id;
                $("#erp_form_vd").attr("action", formAction);
                $.when($('#erp_form_vd').populate(data)).done(function (x) {
                    $(".overlay").hide();
                    $('#tourSeriesVisaDetailsModel').modal('show');
                });
            });
        });

        var dataColumns = [{
            data: "_id",
            sTitle: "Id",
            visible: false
        }, {
            data: "TOURCODE",
            sTitle: "TCD",
            className: "column-20",
            visible: true,
            render: function (data, type, row) {
                return '<a href="#" class="editGridData" data-id="' + row._id + '">' + row.TOURCODE + '</a>';
            }
        }, {
            data: "TOURNAME",
            sTitle: "TOURNAME",
            className: "column-200",
            visible: true,
        }, {
            data: "VISA_1",
            sTitle: "VISA",
            className: "column-10",
            visible: true,
        }, {
            data: "VTYP_1",
            sTitle: "VTYP_1",
            visible: false,
        }, {
            data: "VDAY_1",
            sTitle: "VDAY_1",
            visible: false,
        }, {
            data: "VISA_2",
            sTitle: "VISA",
            className: "column-10",
            visible: true,
        }, {
            data: "VTYP_2",
            sTitle: "VTYP_2",
            visible: false,
        }, {
            data: "VDAY_2",
            sTitle: "VDAY_2",
            visible: false,
        }, {
            data: "VISA_3",
            sTitle: "VISA",
            className: "column-10",
            visible: true,
        }, {
            data: "VTYP_3",
            sTitle: "VTYP_3",
            visible: false,
        }, {
            data: "VDAY_3",
            sTitle: "VDAY_3",
            visible: false,
        }, {
            data: "VISA_4",
            sTitle: "VISA",
            className: "column-10",
            visible: true,
        }, {
            data: "VTYP_4",
            sTitle: "VTYP_4",
            visible: false,
        }, {
            data: "VDAY_4",
            sTitle: "VDAY_4",
            visible: false,
        }, {
            data: "VISA_BKDAY",
            sTitle: "DAYS",
            className: "column-20",
            visible: true,
        }, {
            data: "VISA_CUTOF",
            sTitle: "CUT-OFF",
            className: "column-25",
            visible: true,
        }, {
            data: "AIRTKT_PNR",
            sTitle: "AIRTKT/PNR",
            className: "column-60",
            visible: true,
        }, {
            data: "HOTEL_VOU",
            sTitle: "HOTEL VOUCHER",
            className: "column-70",
            visible: true,
        },];

        var DrawTableInquiry = DrawCustomDataTable("tour_slide_table", 350, "/route/TOURNAME/grid-data", dataColumns, [
            [0, "desc"]
        ], "frm-grid-search", null, true, true);

        $("#frm-grid-search").validate({
            errorPlacement: function (error, element) {
            }, submitHandler: function (form) {
                DrawTableInquiry.ajax.reload();
            }
        });

        $("#erp_form_vd").validate({
            rules: {},
            errorPlacement: function (error, element) { },
            submitHandler: function (form) {
                $(".overlay").show();
                var $form = $(form);
                var url = $form.attr('action');
                // url += SubmitUrlId;
                var formData = $form.serializeObject();
                $.ajax({
                    url: url,
                    type: "PUT",
                    data: JSON.stringify(formData),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (result) {
                        document.getElementById("erp_form_vd").reset();
                        if (result.message) {
                            $(".overlay").hide();
                            // if (action_type == "PUT") {
                            $("#custom_success_vd").alert();
                            $("#custom_success_vd").fadeTo(2000, 500).slideUp(500, function () { });
                            $(".form_add_entry").trigger("click");
                            // } else {
                            //     $("#success-alert-vd").alert();
                            //     $("#success-alert-vd").fadeTo(2000, 500).slideUp(500, function() {});
                            // }
                            // if (action_type == "POST") {
                            document.getElementById("erp_form_vd").reset();
                            $('#tourSeriesVisaDetailsModel').modal('hide');
                            // } else {
                            //     $('.btn-submit').attr('disabled', 'disabled');
                            // }
                            DrawTableInquiry.ajax.reload();
                        }
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        $(".overlay").hide();
                        if (jqXHR.status == 200 || jqXHR.status == 302) {
                            window.location.href = '/login';
                        }
                        var result = jQuery.parseJSON(jqXHR.responseText);
                        if (jqXHR.status == 500) {

                            $(".custom_error").html(result.message);

                            $("#danger-alert-vd").alert();

                            $("#danger-alert-vd").fadeTo(2000, 500).slideUp(500, function () { $('#tourSeriesVisaDetailsModel').modal('hide'); });
                        } else {
                            $(".custom_error").html(errorThrown);
                            $("#danger-alert-vd").alert();

                            $("#danger-alert-vd").fadeTo(2000, 500).slideUp(500, function () { $('#tourSeriesVisaDetailsModel').modal('hide'); });
                        }
                    }
                });
            }
        });

    });
</script>
<% include ../partials/footer %>