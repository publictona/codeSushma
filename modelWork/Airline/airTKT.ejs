<% include ../partials/head %>
    <% include ../partials/header %>

        <style>
            .imageLimit {
                color: #ed1c24;
                font-style: italic;
            }

            .imagepointer {
                pointer-events: auto;
                cursor: pointer;
            }

            .wellkesexc {
                width: 50%;
                margin-top: 4%;
                padding: 10px;
                position: relative;
            }

            .kesexccancel {
                position: absolute;
                top: 0%;
                left: 85%;
                background-color: #989898;
                border-radius: 100%;
                width: 15%;
                color: #fff;
                font-weight: 700;
                text-align: center;
                font-size: 14px;
            }

            .kesexccanceldesk {
                position: absolute;
                top: 0%;
                left: 85%;
                background-color: #989898;
                border-radius: 100%;
                width: 15%;
                color: #fff;
                font-weight: 700;
                text-align: center;
                font-size: 14px;
            }

            .kesexccanceldesk a,
            .kesexccancel a {
                color: white;
            }

            .mr-15 {
                margin-right: 15px;
            }

            .tr-group {
                display: flex;
                gap: 10px;
            }

            .pd-12 {
                padding: 12px;
            }

            .modal-body-work_tran table {
                width: 100%;
            }

            .modal-body-work_tran .mt-20 {
                margin-top: 20px;
            }
        </style>
        <div id="work_tranModal" class="modal fade" role="dialog">
            <div class="modal-dialog">

                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">99 Master Details</h4>
                    </div>
                    <div class="modal-body modal-body-work_tran pd-12">

                        <div class="form-group d-flex tr-srh">
                            <label>
                                <strong>Tour Series</strong>&nbsp;:&nbsp;<strong class="TM_ID"></strong>
                            </label>
                            <div class="tr-group">
                                <input type="text" class="form-control" name="TM_Series" id="TM_Series" />
                                <button type="button" class="btn btn-primary" onclick="getData99()">View</button>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12">
                                <label>
                                    <strong>Tour 999999 Master</strong>
                                </label>
                                <input type="hidden" name="tourSec" id="tourSec" value="">
                                <table class="table table-bordered table-striped display nowrap w-100">
                                    <thead>
                                        <tr>
                                            <th>TourCode</th>
                                            <th>Company</th>
                                            <th>Zone</th>
                                            <th>Days</th>
                                            <th>PAXMKT</th>
                                            <th>PAXMIN</th>
                                            <th>PAXMAX</th>
                                            <th>FINCATG</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tourmasTable1">

                                    </tbody>
                                </table>
                            </div>

                            <div class="col-md-12 mt-20">
                                <label>
                                    <strong>Tour Sector</strong>
                                </label>

                                <table class="table table-bordered table-striped display nowrap w-100">
                                    <thead>
                                        <tr>
                                            <th>TourCode</th>
                                            <th>Sector Name</th>
                                            <th>Sector</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tourmasTable2">

                                    </tbody>
                                </table>
                            </div>
                        </div>

                    </div>
                    <!-- <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div> -->
                </div>

            </div>
        </div>
        <div class="row">
            <div class="col-md-7">
                <div class="box box-primary">
                    <div class="box-header with-border">
                        <h4 class="box-title form-title">Air Ticket</h4>
                        <!-- <button class="btn btn-primary form_add_entry  pull-right" type="button">Add New</button>
                        <button class="btn btn-primary  pull-right mr-15" onclick="master99()" type="button">Check 99Master</button> -->

                    </div>
                    <form id="erp_form_grp" action="/route/feedbackLink/create" method="POST" autocomplete="OFF">
                        <div class="box-body">
                            <div class="row gutter--3px">
                                <div class="col-md-12">
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label for="">
                                                <strong>ID/Both</strong>
                                            </label>
                                            <input type="hidden" class="form-control" name="id" id="masId" value="0" />
                                            <!-- <input type="text" class="form-control" name="F_INTDOM" id="F_INTDOM" /> -->
                                            <select name="F_INTDOM" id="F_INTDOM" class="form-control enquery-source" >
                                                <option value="">Select</option>
                                                <option value="I">I</option>
                                                <option value="D">D</option>
                                                <option value="B">Both</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label for="">
                                                <strong>ALN/BSP</strong>
                                            </label>
                                           
                                            <select name="F_AIRLNNO" id="F_AIRLNNO" class="form-control enquery-source" >
                                                <option value="">Select</option>
                                                <option value="ALN">ALN</option>
                                                <option value="BSP">BSP</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="">
                                                <strong>ALN</strong>
                                            </label>
                                           
                                            <select name="ALN" id="ALN" class="form-control enquery-source" disabled>
                                                <option value="">Select</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="">
                                                <strong>By Agent</strong>
                                            </label>
                                           
                                            <select name="F_AGENTCD" id="F_AGENTCD" class="form-control enquery-source" >
                                                <option value="">Select</option>
                                                <option value="I">I</option>
                                                <option value="D">D</option>
                                                <option value="B">Both</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="">
                                                <strong>Branch</strong>
                                            </label>
                                             <input type="text" class="form-control" name="KT_BRANCH" id="KT_BRANCH" /> 
                                            
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="">
                                                <strong>Start Tkt</strong>
                                            </label>
                                             <input type="text" class="form-control" name="F_FROMTKT" id="F_FROMTKT" /> 
                                            
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="">
                                                <strong>Ticket No</strong>
                                            </label>
                                             <input type="text" class="form-control" name="F_TICKET" id="F_TICKET" /> 
                                            
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="">
                                                <strong>End Tkt</strong>
                                            </label>
                                             <input type="text" class="form-control" name="F_TILLTKT" id="F_TILLTKT" /> 
                                            
                                        </div>
                                    </div>
                                    <div class="col-md-6"></div>
                                        <div class="form-group">
                                            <label for="">
                                                <strong>Cheque No</strong>
                                            </label>
                                             <input type="text" class="form-control" name="F_CHQNO" id="F_CHQNO" /> 
                                            
                                        </div>
                                    </div>
                                    <div class="col-md-6"></div>
                                        <div class="form-group">
                                            <label for="">
                                                <strong>Date</strong>
                                            </label>
                                             <input type="text" class="form-control" name="F_CHQDT" id="F_CHQDT" /> 
                                            
                                        </div>
                                    </div>
                                    <div class="col-md-6"></div>
                                        <div class="form-group">
                                            <label for="">
                                                <strong>Cheque Rs</strong>
                                            </label>
                                             <input type="text" class="form-control" name="F_CHQRS" id="F_CHQRS"/> 
                                            
                                        </div>
                                    </div>
                                    <div class="col-md-6"></div>
                                        <div class="form-group">
                                            <label for="">
                                                <strong>By Bill No</strong>
                                            </label>
                                             <input type="text" class="form-control" name="F_BILL_NO" id="F_BILL_NO"/> 
                                            
                                        </div>
                                    </div>
                                    <div class="col-md-6"></div>
                                        <div class="form-group">
                                            <label for="">
                                                <strong>Bill Dt</strong>
                                            </label>
                                             <input type="text" class="form-control" name="F_BILLDT" id="F_BILLDT"/> 
                                            
                                        </div>
                                    </div>
                                    


                                </div>
                               


                                <div class="col-md-12">
                                    <div class="box-footer">
                                        <button type="submit" class="btn btn-primary btn-guest btn-block"
                                            id="erp_formSubmit">Submit
                                        </button>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="alert alert-success hide-alert-box" id="success-alert-item">
                                        <button type="button" class="close" data-dismiss="alert">x</button>
                                        <strong>Success! </strong> Record added successfully.
                                    </div>
                                    <div class="alert alert-success hide-alert-box" id="custom_success-item">
                                        <button type="button" class="close" data-dismiss="alert">x</button>
                                        <strong>Success! </strong> Record Update successfully.
                                    </div>
                                    <div class="alert alert-danger hide-alert-box" id="danger-alert">
                                        <button type="button" class="close" data-dismiss="alert">x</button>
                                        <strong>Error! </strong> <span class="custom_error"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div class="col-md-5">
                <div class="box box-primary">
                    <div class="box-body">
                        <table id="TR_LANHDDataTable" class="table table-bordered table-striped display nowrap">
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <script>
            $(document).ready(function () {
               $('#F_AIRLNNO').change(function(){
                var F_AGENTCD = $("#F_AGENTCD").val();
                if(F_AGENTCD == "ALN"){
                    $('#ALN').attr("enabled","enabled");
                }else{
                    $('#ALN').attr("disabled","disabled");
                }
               })
               $("#F_TICKET").keyup(function(){
                    var startTKT = parseInt($("#F_FROMTKT").val());
                    var noTKT = parseInt($("#F_TICKET").val());
                    var endTKT =startTKT+noTKT;
                    console.log(startTKT,noTKT,endTKT);
                    var data = {startTKT:startTKT,noTKT:noTKT,endTKT:endTKT};
                    $.ajax({
                        url:'/route/airTicket/checkTKT',
                        method:'post',
                        data:data,
                        success:function(response){
                            console.log(response);
                            if(response.data == true){
                                $("#erp_formSubmit").attr("disabled","disabled");
                                alert("Already Ticket No Defined");
                            }
                        }
                    })
               })

                var dataColumns = [
                    {
                        data: "_id",
                        sTitle: "Id",
                        visible: false
                    }, {
                        data: "feedBack_Category",
                        sTitle: "FeedBack Category",
                        visible: true,
                        className: "column-100",
                        render: function (data, type, row) {
                            if (data) {
                                return '<a href="#" data-id="'+row._id+'" class="grid-edit"  onclick="getEdit(this)">' + row.feedBack_Category + '</a>';
                            } else {
                                return '';
                            }
                        },

                    }, {
                        data: "feedBackLink",
                        sTitle: "feedBack_Prompt",
                        visible: true,
                        className: "column-200",
                        render: function (data, type, row) {
                            var html =``;
                            // console.log("row.feedBackLink",row);
                            // html+=`<table><thead><tr><th>feedBack_Prompt</th><th>feedBack_Rating</th></tr></thead><tbody>`;
                            //     for(var i=0;i<row.feedBackLink.length;i++){
                            //        html+=` <tr><td>${row.feedBackLink[i].feedBack_Prompt}</td><td>${row.feedBackLink[i].feedBack_Rating}</td></tr>`;
                            //     }
                            // html+=`</tbody></table>`;
                            for(var i=0;i<1;i++){
                                html+=`${row.feedBackLink[i].feedBack_Prompt}`;
                            }
                            return html;
                        }

                    }, {
                        data: "feedBackLink",
                        sTitle: "feedBack_Rating",
                        visible: true,
                        className: "column-200",
                        render: function (data, type, row) {
                            var html =``;
                            // console.log("row.feedBackLink",row);
                            // html+=`<table><thead><tr><th>feedBack_Prompt</th><th>feedBack_Rating</th></tr></thead><tbody>`;
                            //     for(var i=0;i<row.feedBackLink.length;i++){
                            //        html+=` <tr><td>${row.feedBackLink[i].feedBack_Prompt}</td><td>${row.feedBackLink[i].feedBack_Rating}</td></tr>`;
                            //     }
                            // html+=`</tbody></table>`;
                            for(var i=0;i<1;i++){
                                html+=`${row.feedBackLink[i].feedBack_Rating}`;
                            }
                            return html;
                        }

                    }
                ];

                var DrawTableInquiry = DrawCustomDataTable("TR_LANHDDataTable", 350,
                    "/route/feedBackLink/grid-view",
                    dataColumns, [
                    [0, "desc"]
                ], "frm-grid-search", null, true, true);
                var NewObject;
                var SubmitUrlId;
                var action_type = "POST";
                $("#erp_form_grp").validate({
                    submitHandler: function (form) {
                        var $form = $(form);
                        var url = $form.attr('action');



                        var formdata = $form.serializeObject();
                        if (formdata.id != 0) {
                            url = '/route/feedBackLink/Update/' + formdata.id;
                            action_type = "put";
                        }

                        //console.log("formdata", formdata);
                        //return false;


                        $.ajax({
                            url: url,
                            type: action_type || "POST",
                            data: JSON.stringify(formdata),
                            contentType: "application/json; charset=utf-8",
                            dataType: "json",
                           
                            success: function (result) {
                                if (result.status) {
                                    notification({ type: "success", message: result.message });
                                    
                                    document.getElementById("erp_form_grp").reset();
                                   DrawTableInquiry.ajax.reload();

                                }

                            },

                        });
                    }

                });

            });

            
            // function getEdit(id) {
                
            //     fetchData(id);
            // }
            function getEdit(id) {
                var linkid = id.getAttribute('data-id');
                var data = { "id": linkid };
                $.ajax({
                    url: '/route/feedBackLink/getEdit',
                    type: "POST",
                    data: JSON.stringify(data),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",

                    success: function (result) {
                        //console.log("result",result)
                        // $.when($('#erp_form_grp').populate(result.data)).done(function (x) {
                        // });

                        $("#feedBack_Category").val(result.data.feedBack_Category);
                        $("#masId").val(result.data._id);
                        var html = ``;
                        var res = result.data.feedBackLink;
                        for (var i = 0; i < res.length; i++) {

                           
                        }
                        $('.tourmastr').html(html);
                    },

                });
                
            }
            function verifySNM(id) {
                var TM_SNM = ($(id).val()).split("-");
                
                var data = { "TM_SNM": TM_SNM };
                $.ajax({
                    url: '/route/nineMaster/verifySNM',
                    type: "POST",
                    data: JSON.stringify(data),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",

                    success: function (result) {
                        if (result.data && result.data.length > 1) {

                        } else {
                            alert("Please Check TM_SNM Something Wrong");
                        }
                    }
                })

            }
           
            function getAgent(){
                $.ajax({
                    url: "/route/rsData/getAR_AGTMS/",
                    type:"get",
                    //data: JSON.stringify(getData),
                    contentType: "application/json; charset=utf-8",
                    dataType   : "json",
                    success: function(result) {
                        console.log("resultttttttttttt",result);
                        result = JSON.stringify(result);
                        result = JSON.parse(result );
                        var options='<option value="">Select User</option>';
                        for (var i = 0; i < result.length; i++) {
                            options+='<option value="'+result[i].F_AGTCD+'">'+result[i].F_AGTNM+'</option>';
                        } 
                        $("#F_AGENTCD").html(options);
                        $("#F_AGENTCD").select2();
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                    }
                });
            }

            function getAirLine(){
                $.ajax({
                    url: "/route/rsData/getAirLine/",
                    type:"get",
                    //data: JSON.stringify(getData),
                    contentType: "application/json; charset=utf-8",
                    dataType   : "json",
                    success: function(result) {
                        console.log("resultttttttttttt",result);
                        result = JSON.stringify(result);
                        result = JSON.parse(result );
                        var options='<option value="">Select User</option>';
                        for (var i = 0; i < result.length; i++) {
                            options+='<option value="'+result[i].F_AIRLNNO+'">'+result[i].F_AIRLNNM+'</option>';
                        } 
                        $("#ALN").html(options);
                        $("#ALN").select2();
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                    }
                });
            }

           
    getAgent();
    getAirLine();
        </script>

        <% include ../partials/footer %>